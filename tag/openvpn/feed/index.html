<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>OpenVPN &#8211; Stefcho&#039;s Tech Blog</title>
	<atom:link href="https://blog.stefcho.eu/tag/openvpn/feed/" rel="self" type="application/rss+xml" />
	<link>http://blog.stefcho.eu/</link>
	<description>Software Development, Cloud, DevOps and PfSense</description>
	<lastBuildDate>Mon, 18 Feb 2019 13:58:17 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.2.2</generator>

<image>
	<url>https://blog.stefcho.eu/wp-content/uploads/2018/10/cropped-0-32x32.jpg</url>
	<title>OpenVPN &#8211; Stefcho&#039;s Tech Blog</title>
	<link>http://blog.stefcho.eu/</link>
	<width>32</width>
	<height>32</height>
</image> 
	<item>
		<title>Sharing a Port with OpenVPN and a Web Server</title>
		<link>https://blog.stefcho.eu/sharing-port-openvpn-web-server/</link>
				<pubDate>Fri, 04 Mar 2016 06:36:35 +0000</pubDate>
		<dc:creator><![CDATA[Stefan]]></dc:creator>
				<category><![CDATA[Technical]]></category>
		<category><![CDATA[OpenVPN]]></category>
		<category><![CDATA[pfSense]]></category>

		<guid isPermaLink="false">http://stefcho.azurewebsites.net/?p=1025</guid>
				<description><![CDATA[<p>Sharing a Port with OpenVPN and a Web Server Routing your entire internet traffic over VPN when away from home is almost a must. Especially when using public WiFi hotspots or hotel internet. Hello all, long time no see. I have a lot of other engagements lately and can’t reach to our beloved topic of [&#8230;]</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/sharing-port-openvpn-web-server/">Sharing a Port with OpenVPN and a Web Server</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></description>
								<content:encoded><![CDATA[<p>Sharing a Port with OpenVPN and a Web Server</p>
<p>Routing your entire internet traffic over VPN when away from home is almost a must. Especially when using public WiFi hotspots or hotel internet.</p>
<p>Hello all, long time no see. I have a lot of other engagements lately and can’t reach to our beloved topic of pfSense. The fact that I don’t write new posts does not mean that I have abandoned it. Sometimes you have to put priorities to things in your life that are not as pleasant as other, but are just as much if not more important.</p>
<p>Enough said about that. Let’s get to the topic.</p>
<p>Recently I was visiting Asian country. As you probably know there are some places that some sites are restricted for access. It was a strange experience to not be able to open pages that you usually use every day. On other hand I would prefer to route all traffic over my Internet connection back at home when in a foreign country. Just as a protection.</p>
<p>So for test purposes I’ve setup an OpenVPN instance to check if I’m able to route all my traffic back home.</p>
<p>During my research I’ve came across very interesting article on the pfSense documentation. The article is: “<a href="https://doc.pfsense.org/index.php/Sharing_a_Port_with_OpenVPN_and_a_Web_Server" target="_blank">Sharing a Port with OpenVPN and a Web Server</a>”</p>
<p>It works and the only modification that has to be made to the OpenVPN server configuration are as follows:</p>
<ol>
<li>Set the protocol to TCP in the General Information section<a href="https://blog.stefcho.eu/wp-content/uploads/2016/03/Sharing-a-Port-with-OpenVPN-and-a-Web-Server-01.png" rel="attachment wp-att-1027"><img class="alignnone size-full wp-image-1027" src="https://blog.stefcho.eu/wp-content/uploads/2016/03/Sharing-a-Port-with-OpenVPN-and-a-Web-Server-01.png" alt="Sharing a Port with OpenVPN and a Web Server 01" width="773" height="131" srcset="https://blog.stefcho.eu/wp-content/uploads/2016/03/Sharing-a-Port-with-OpenVPN-and-a-Web-Server-01.png 773w, https://blog.stefcho.eu/wp-content/uploads/2016/03/Sharing-a-Port-with-OpenVPN-and-a-Web-Server-01-300x51.png 300w, https://blog.stefcho.eu/wp-content/uploads/2016/03/Sharing-a-Port-with-OpenVPN-and-a-Web-Server-01-768x130.png 768w" sizes="(max-width: 773px) 100vw, 773px" /></a></li>
<li>Don’t forget to tick in the Tunnel Settings &gt; Redirect Gateway</li>
</ol>
<p>(Force all client generated traffic through the tunnel.)</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2016/03/Sharing-a-Port-with-OpenVPN-and-a-Web-Server-03.png" rel="attachment wp-att-1029"><img class="alignnone size-full wp-image-1029" src="https://blog.stefcho.eu/wp-content/uploads/2016/03/Sharing-a-Port-with-OpenVPN-and-a-Web-Server-03.png" alt="Sharing a Port with OpenVPN and a Web Server 03" width="825" height="49" srcset="https://blog.stefcho.eu/wp-content/uploads/2016/03/Sharing-a-Port-with-OpenVPN-and-a-Web-Server-03.png 825w, https://blog.stefcho.eu/wp-content/uploads/2016/03/Sharing-a-Port-with-OpenVPN-and-a-Web-Server-03-300x18.png 300w, https://blog.stefcho.eu/wp-content/uploads/2016/03/Sharing-a-Port-with-OpenVPN-and-a-Web-Server-03-768x46.png 768w" sizes="(max-width: 825px) 100vw, 825px" /></a></p>
<ol start="3">
<li>In Advanced configuration section in Advanced field put the following:</li>
</ol>
<p>port-share localhost 443<a href="https://blog.stefcho.eu/wp-content/uploads/2016/03/Sharing-a-Port-with-OpenVPN-and-a-Web-Server-02.png" rel="attachment wp-att-1026"><img class="alignnone size-full wp-image-1026" src="https://blog.stefcho.eu/wp-content/uploads/2016/03/Sharing-a-Port-with-OpenVPN-and-a-Web-Server-02.png" alt="Sharing a Port with OpenVPN and a Web Server 02" width="761" height="163" srcset="https://blog.stefcho.eu/wp-content/uploads/2016/03/Sharing-a-Port-with-OpenVPN-and-a-Web-Server-02.png 761w, https://blog.stefcho.eu/wp-content/uploads/2016/03/Sharing-a-Port-with-OpenVPN-and-a-Web-Server-02-300x64.png 300w" sizes="(max-width: 761px) 100vw, 761px" /></a></p>
<p>The old OpenVPN configuration instructions you can find here:</p>
<h2 class="post-title"><a title="Permanent Link to pfSense 2.0 RC1 configuration of OpenVPN Server for Road Warrior with TLS and User Authentication" href="http://stefcho.azurewebsites.net/pfsense-2-0-rc1-configuration-of-openvpn-server-for-rad-warrior-with-tls-and-user-authentication/" rel="bookmark permalink">pfSense 2.0 RC1 configuration of OpenVPN Server for Road Warrior with TLS and User Authentication</a></h2>
<p>Now you can connect to your pfSense / OpenVPN server on HTTPS and hopefully it would appear much like you are opening a page over SSL.</p>
<p>Have fun and as usual I don’t take any kind of responsibly for the way you use this setup, or any legal actions or consequences for that matter or related to it.</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/sharing-port-openvpn-web-server/">Sharing a Port with OpenVPN and a Web Server</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></content:encoded>
										</item>
		<item>
		<title>Using your OpenVPN Road Warrior setup as a Secure Relay</title>
		<link>https://blog.stefcho.eu/using-your-openvpn-road-warrior-setup-as-a-secure-relay/</link>
				<comments>https://blog.stefcho.eu/using-your-openvpn-road-warrior-setup-as-a-secure-relay/#comments</comments>
				<pubDate>Wed, 07 Sep 2011 20:16:49 +0000</pubDate>
		<dc:creator><![CDATA[Stefan]]></dc:creator>
				<category><![CDATA[Technical]]></category>
		<category><![CDATA[Network]]></category>
		<category><![CDATA[OpenVPN]]></category>
		<category><![CDATA[pfSense]]></category>
		<category><![CDATA[pfSense 2.0 RC3]]></category>

		<guid isPermaLink="false">http://stefcho.azurewebsites.net/?p=956</guid>
				<description><![CDATA[<p>Introduction If you are in a café or another place with free wireless Internet access you are under a security risk. Your traffic can be monitored, captured and analysed. Your sensitive data can be stolen or your laptop infected with malicious application. To avoid as much as possible of the above we can route all [&#8230;]</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/using-your-openvpn-road-warrior-setup-as-a-secure-relay/">Using your OpenVPN Road Warrior setup as a Secure Relay</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></description>
								<content:encoded><![CDATA[<p><strong>Introduction</strong></p>
<p>If you are in a café or another place with free wireless Internet access you are under a security risk. Your traffic can be monitored, captured and analysed. Your sensitive data can be stolen or your laptop infected with malicious application.</p>
<p>To avoid as much as possible of the above we can route all your traffic through the internet connection at home or in your office.</p>
<p><strong>Configuration</strong></p>
<p>As a base configuration you can use <a href="http://stefcho.azurewebsites.net/?p=492" target="_blank">pfSense 2.0 RC1 configuration of OpenVPN Server for Road Warrior with TLS and User Authentication</a></p>
<p>up until the Tunnel Settings section of the OpenVPN Configuration.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/09/Using-your-OpenVPN-Road-Warrior-setup-as-a-Secure-Relay-for-the-users-01.png"><img class="alignnone size-full wp-image-957" title="Using your OpenVPN Road Warrior setup as a Secure Relay for the users - 01" src="https://blog.stefcho.eu/wp-content/uploads/2011/09/Using-your-OpenVPN-Road-Warrior-setup-as-a-Secure-Relay-for-the-users-01.png" alt="" width="909" height="678" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/09/Using-your-OpenVPN-Road-Warrior-setup-as-a-Secure-Relay-for-the-users-01.png 909w, https://blog.stefcho.eu/wp-content/uploads/2011/09/Using-your-OpenVPN-Road-Warrior-setup-as-a-Secure-Relay-for-the-users-01-300x223.png 300w, https://blog.stefcho.eu/wp-content/uploads/2011/09/Using-your-OpenVPN-Road-Warrior-setup-as-a-Secure-Relay-for-the-users-01-200x150.png 200w" sizes="(max-width: 909px) 100vw, 909px" /></a></p>
<p>There tick the Redirect Gateway.</p>
<p>&nbsp;</p>
<p>Under Client Settings enter DNS Server 1 as the IP address of you LAN interface.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/09/Using-your-OpenVPN-Road-Warrior-setup-as-a-Secure-Relay-for-the-users-02.png"><img class="alignnone size-full wp-image-958" title="Using your OpenVPN Road Warrior setup as a Secure Relay for the users - 02" src="https://blog.stefcho.eu/wp-content/uploads/2011/09/Using-your-OpenVPN-Road-Warrior-setup-as-a-Secure-Relay-for-the-users-02.png" alt="" width="909" height="678" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/09/Using-your-OpenVPN-Road-Warrior-setup-as-a-Secure-Relay-for-the-users-02.png 909w, https://blog.stefcho.eu/wp-content/uploads/2011/09/Using-your-OpenVPN-Road-Warrior-setup-as-a-Secure-Relay-for-the-users-02-300x223.png 300w, https://blog.stefcho.eu/wp-content/uploads/2011/09/Using-your-OpenVPN-Road-Warrior-setup-as-a-Secure-Relay-for-the-users-02-200x150.png 200w" sizes="(max-width: 909px) 100vw, 909px" /></a></p>
<p><strong>Explanation</strong></p>
<p>By doing so you will redirect all your traffic through the VPN connection and avoid the risks related to the publicly available Internet access hotspots. The addition of DNS server address is needed in order to use you own device to resolve web sites IPs instead of the publicly available DNS server of the hotspot.</p>
<p><strong>Testing</strong></p>
<p>As a test you can trace route (tracert bbc.co.uk for example) a popular internet site with or without established VPN Connection.</p>
<p><strong>Conclusion</strong></p>
<p>At the cost of building just another VPN Server on your device you are gaining a little peace of mind while surfing the net from insecure location.</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/using-your-openvpn-road-warrior-setup-as-a-secure-relay/">Using your OpenVPN Road Warrior setup as a Secure Relay</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></content:encoded>
							<wfw:commentRss>https://blog.stefcho.eu/using-your-openvpn-road-warrior-setup-as-a-secure-relay/feed/</wfw:commentRss>
		<slash:comments>7</slash:comments>
							</item>
		<item>
		<title>OpenVPN on pfSense 2.0 RC3 with OpenLDAP Authentication on CentOS 5.6</title>
		<link>https://blog.stefcho.eu/openvpn-on-pfsense-2-0-rc3-with-openldap-authentication-on-centos-5-6/</link>
				<comments>https://blog.stefcho.eu/openvpn-on-pfsense-2-0-rc3-with-openldap-authentication-on-centos-5-6/#comments</comments>
				<pubDate>Sat, 13 Aug 2011 09:31:34 +0000</pubDate>
		<dc:creator><![CDATA[Stefan]]></dc:creator>
				<category><![CDATA[Technical]]></category>
		<category><![CDATA[CentOS]]></category>
		<category><![CDATA[LDAP]]></category>
		<category><![CDATA[OpenLDAP]]></category>
		<category><![CDATA[OpenVPN]]></category>
		<category><![CDATA[pfSense]]></category>
		<category><![CDATA[pfSense 2.0 RC3]]></category>

		<guid isPermaLink="false">http://stefcho.azurewebsites.net/?p=916</guid>
				<description><![CDATA[<p>Introduction After writing OpenVPN with LDAP authentication on pfSense 2.0 RC1, a reader of my blog shared some problems with configuring OpenLDAP on CentOS.&#160; So I decide to build such a setup and test. Scenario The scenario is as follows, authenticating users requiring access to the OpenVPN server against OpenLDAP service running on CentOS. Setup [&#8230;]</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/openvpn-on-pfsense-2-0-rc3-with-openldap-authentication-on-centos-5-6/">OpenVPN on pfSense 2.0 RC3 with OpenLDAP Authentication on CentOS 5.6</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></description>
								<content:encoded><![CDATA[<p><strong>Introduction</strong></p>
<p>After writing OpenVPN with LDAP authentication on pfSense 2.0 RC1, a reader of my blog shared some problems with configuring OpenLDAP on CentOS.&nbsp; So I decide to build such a setup and test.</p>
<p><strong>Scenario</strong></p>
<p>The scenario is as follows, authenticating users requiring access to the OpenVPN server against OpenLDAP service running on CentOS.</p>
<p><strong>Setup</strong></p>
<p>I’ve spent most time in preparing the CentOS server. Initially my decision was to use CentOS 6.0, but after a few failed attempts to configure it and the absence of how to guides for this purpose, I’ve decided to fall back to 5.6.</p>
<p>For this version there is a wonderful how to guide here:</p>
<p><a href="http://drozd.com/2011/04/22/openldap-on-centos-5-6/" target="_blank">OpenLDAP on CentOS 5.6</a></p>
<p><a href="http://drozd.com/2011/04/22/openldap-on-centos-5-6/" target="_blank">Install And Configure OpenLDAP 2.4.25 On CentOS 5.6</a></p>
<p>Following this instructions I’ve managed to setup OpenLDAP very fast.&nbsp; The only comment that I have is in this section:</p>
<blockquote><p>All data loaded is in&nbsp;<a title="LDAP Data Interchange Format" href="http://en.wikipedia.org/wiki/LDAP_Data_Interchange_Format" target="_blank">LDIF</a> format. Create a file to initialize the LDAP database:</p>
<p># vi ldap-init.ldif</p>
<p>dn: dc=mycompany,dc=com</p>
<p>objectclass: dcObject</p>
<p>objectclass: organization</p>
<p>o: Example</p>
<p>dc: mycompany</p>
<p>dn: cn=Admin,dc=mycompany,dc=com</p>
<p>objectclass: organizationalRole</p>
<p>cn: Admin</p>
<p>&nbsp;</p></blockquote>
<p>you have to have one new row, otherwise the import in the next step fails. So the above should look like:</p>
<blockquote><p># vi ldap-init.ldif</p>
<p>dn: dc=mycompany,dc=com</p>
<p>objectclass: dcObject</p>
<p>objectclass: organization</p>
<p>o: Example</p>
<p>dc: mycompany</p>
<p>&nbsp;</p>
<p>dn: cn=Admin,dc=mycompany,dc=com</p>
<p>objectclass: organizationalRole</p>
<p>cn: Admin</p>
<p>&nbsp;</p></blockquote>
<p>&nbsp;</p>
<p>Next step is to create a few test users. &nbsp;For that purpose I’ve used :</p>
<p><a href="http://ldapadmin.sourceforge.net/" target="_blank">LDAP Admin</a></p>
<blockquote><p>Ldap Admin is free Win32 administration tool for LDAP directory management. This application lets you browse, search, modify, create and delete objects on LDAP server. It also supports more complex operations such as directory copy and move between remote servers and extends the common edit functions to support specific object types (such as groups and accounts).</p>
<p>You can use it to manage Posix groups and accounts, Samba accounts and it even includes support for Postfix MTA. Ldap Admin is free Open Source software distributed under the GNU General Public License.</p></blockquote>
<p><strong>Configuration</strong></p>
<p>It is time to configure the pfSense. I will skip all the steps described in the previous posts. You can find them here:</p>
<p><a href="http://stefcho.azurewebsites.net/?p=492" target="_blank">pfSense 2.0 RC1 configuration of OpenVPN Server for Road Warrior with TLS and User Authentication</a></p>
<p><a href="http://stefcho.azurewebsites.net/?p=528" target="_blank">OpenVPN with LDAP authentication on pfSense 2.0 RC1</a></p>
<p>Now let’s get straight to System &gt; User Manager and on the Servers leaf.</p>
<p><strong>Hostname or IP address:</strong> this it the address of the CentOS server</p>
<p><strong>Base DN</strong>: this is the domain name</p>
<p><strong>Authentication container</strong>: after insterted the Bind credentials, it was visible, but when I&#8217;ve click on the Save button, nothing happen. So I&#8217;ve typed it in manually.</p>
<p><strong>Bind Credentials</strong>: enter User DN and Password. , I&#8217;ve tested it and with <strong>Use anonymous binds to resolve distinguished names</strong>, it works also.</p>
<p><strong>Group Member Attribute</strong>: you can modify this with the Uid=%s, if you need.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/08/Authenticaton-Config.png"><img class="alignnone size-full wp-image-917" title="Authenticaton Config" src="https://blog.stefcho.eu/wp-content/uploads/2011/08/Authenticaton-Config.png" alt="" width="888" height="732" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/08/Authenticaton-Config.png 888w, https://blog.stefcho.eu/wp-content/uploads/2011/08/Authenticaton-Config-300x247.png 300w" sizes="(max-width: 888px) 100vw, 888px" /></a></p>
<p><strong>Testing</strong></p>
<p>Just for reference this is my test user.<strong><br />
</strong></p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/08/LDAP-Admin.png"><img class="alignnone size-full wp-image-918" title="LDAP Admin" src="https://blog.stefcho.eu/wp-content/uploads/2011/08/LDAP-Admin.png" alt="" width="742" height="409" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/08/LDAP-Admin.png 742w, https://blog.stefcho.eu/wp-content/uploads/2011/08/LDAP-Admin-300x165.png 300w" sizes="(max-width: 742px) 100vw, 742px" /></a></p>
<p>After preforming the OpenVPN configuration, enter the user name and the password.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/08/OpenVPN-Login.png"><img class="alignnone size-full wp-image-920" title="OpenVPN Login" src="https://blog.stefcho.eu/wp-content/uploads/2011/08/OpenVPN-Login.png" alt="" width="577" height="372" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/08/OpenVPN-Login.png 577w, https://blog.stefcho.eu/wp-content/uploads/2011/08/OpenVPN-Login-300x193.png 300w" sizes="(max-width: 577px) 100vw, 577px" /></a></p>
<p>If everything is OK, you should be successfully connected and see something similar in the OpenVPN logs:</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/08/OpenVPN-server-Log.png"><img class="alignnone size-full wp-image-919" title="OpenVPN server Log" src="https://blog.stefcho.eu/wp-content/uploads/2011/08/OpenVPN-server-Log.png" alt="" width="805" height="423" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/08/OpenVPN-server-Log.png 805w, https://blog.stefcho.eu/wp-content/uploads/2011/08/OpenVPN-server-Log-300x157.png 300w" sizes="(max-width: 805px) 100vw, 805px" /></a></p>
<p>You can also test the connection using the Diagnostics &gt; Authentication, Select the Authentication Server, in my case the CentOS OpenLDAP connection is named Test. Enter Username and Password, and see the result.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/08/Test-Authentication.png"><img class="alignnone size-full wp-image-943" title="Test Authentication" src="https://blog.stefcho.eu/wp-content/uploads/2011/08/Test-Authentication.png" alt="" width="881" height="342" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/08/Test-Authentication.png 881w, https://blog.stefcho.eu/wp-content/uploads/2011/08/Test-Authentication-300x116.png 300w" sizes="(max-width: 881px) 100vw, 881px" /></a></p>
<p>If you get error, you can check the Status&gt; System Logs on the System leaf for errors.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/08/Test-Authenticaion-Error-Msg.png"><img class="alignnone size-full wp-image-944" title="Test Authenticaion Error Msg" src="https://blog.stefcho.eu/wp-content/uploads/2011/08/Test-Authenticaion-Error-Msg.png" alt="" width="886" height="387" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/08/Test-Authenticaion-Error-Msg.png 886w, https://blog.stefcho.eu/wp-content/uploads/2011/08/Test-Authenticaion-Error-Msg-300x131.png 300w" sizes="(max-width: 886px) 100vw, 886px" /></a></p>
<p>I&#8217;ve got this error when the CentOS server was turn off.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/08/Test-Authenticaion-Error-System-Logs.png"><img class="alignnone size-full wp-image-945" title="Test Authenticaion Error System Logs" src="https://blog.stefcho.eu/wp-content/uploads/2011/08/Test-Authenticaion-Error-System-Logs.png" alt="" width="887" height="262" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/08/Test-Authenticaion-Error-System-Logs.png 887w, https://blog.stefcho.eu/wp-content/uploads/2011/08/Test-Authenticaion-Error-System-Logs-300x88.png 300w" sizes="(max-width: 887px) 100vw, 887px" /></a></p>
<p><strong>Issues</strong></p>
<p>The issues that I faced was the problem with selecting the OU in which my users resides. Hope this will be fixed in future versions<strong>. </strong>On the CentOS side the problems were releted with the changes of OpenLDAP in the 6.0 version.<strong><br />
</strong></p>
<p><strong> Conclusion</strong></p>
<p>That’s it. Thank you for reading.</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/openvpn-on-pfsense-2-0-rc3-with-openldap-authentication-on-centos-5-6/">OpenVPN on pfSense 2.0 RC3 with OpenLDAP Authentication on CentOS 5.6</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></content:encoded>
							<wfw:commentRss>https://blog.stefcho.eu/openvpn-on-pfsense-2-0-rc3-with-openldap-authentication-on-centos-5-6/feed/</wfw:commentRss>
		<slash:comments>2</slash:comments>
							</item>
		<item>
		<title>Routing Road Warrior’s clients through a Site-To-Site VPN with pfSense 2.0 RC1 and OpenVPN</title>
		<link>https://blog.stefcho.eu/routing-road-warriors-clients-through-a-site-to-site-vpn-with-pfsense-2-0-rc1-and-openvpn/</link>
				<comments>https://blog.stefcho.eu/routing-road-warriors-clients-through-a-site-to-site-vpn-with-pfsense-2-0-rc1-and-openvpn/#comments</comments>
				<pubDate>Sat, 04 Jun 2011 14:39:06 +0000</pubDate>
		<dc:creator><![CDATA[Stefan]]></dc:creator>
				<category><![CDATA[Technical]]></category>
		<category><![CDATA[Network]]></category>
		<category><![CDATA[OpenVPN]]></category>
		<category><![CDATA[pfSense]]></category>
		<category><![CDATA[Routing]]></category>

		<guid isPermaLink="false">http://stefcho.azurewebsites.net/?p=733</guid>
				<description><![CDATA[<p>After we looked at the different options for Road Warrior and Site to Site configuration for OpenVPN on pfSense 2.0 RC1, now it is time to combine them in one solution. Scenario You have one or more Site to Site VPNs already and at least one Road Warrior setup for your users. Initially you are [&#8230;]</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/routing-road-warriors-clients-through-a-site-to-site-vpn-with-pfsense-2-0-rc1-and-openvpn/">Routing Road Warrior’s clients through a Site-To-Site VPN with pfSense 2.0 RC1 and OpenVPN</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></description>
								<content:encoded><![CDATA[<p>After we looked at the different options for Road Warrior and Site to Site configuration for OpenVPN on pfSense 2.0 RC1, now it is time to combine them in one solution.</p>
<h1>Scenario</h1>
<p>You have one or more Site to Site VPNs already and at least one Road Warrior setup for your users. Initially you are happy that you users can consume services from the site that hosts the Road Warrior, but then you want to give them access through the same connection to other sites connected to your main one.</p>
<h1>Setup</h1>
<p>Take a look at the network diagram.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/06/OpenVPN-site-to-site-and-Road-Warrior-routing.png"><img class="aligncenter size-full wp-image-734" title="OpenVPN site to site and Road Warrior, routing" src="https://blog.stefcho.eu/wp-content/uploads/2011/06/OpenVPN-site-to-site-and-Road-Warrior-routing.png" alt="" width="769" height="412" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/06/OpenVPN-site-to-site-and-Road-Warrior-routing.png 769w, https://blog.stefcho.eu/wp-content/uploads/2011/06/OpenVPN-site-to-site-and-Road-Warrior-routing-300x160.png 300w" sizes="(max-width: 769px) 100vw, 769px" /></a></p>
<p>pfSense01 serves the main site, and provides access to the remote users, but also has a site to site configuration with pfSense02.</p>
<p>If you are on the LAN (10.10.9.0/24) side behind pfSense01, you will be able to access machines through the Site to Site connection and communicate with machines on the other end, for example 10.10.10.99.</p>
<p>But if you are the VPN Client, you will be able to only access machines in the 10.10.9.0/24 network.</p>
<p>Our aim is to provide the VPN Client access to network behind pfSense02 (10.10.10.0/24) in addition to the 10.10.9.0/24 one.</p>
<h1>Configuration</h1>
<p>If you have already configured Road Warrior and Site To Site configuration skip to the Advanced Configuration section below.</p>
<h2>Road Warrior</h2>
<p>For reference how to configure it, you can look at my other posts, and choose depending on your needs:</p>
<p><a href="http://stefcho.azurewebsites.net/?p=492" target="_blank">pfSense 2.0 RC1 configuration of OpenVPN Server for Rad Warrior with TLS and User Authentication</a></p>
<p><a href="http://stefcho.azurewebsites.net/?p=528" target="_blank">OpenVPN with LDAP authentication on pfSense 2.0 RC1</a></p>
<p><a href="http://stefcho.azurewebsites.net/?p=545" target="_blank">OpenVPN with RADIUS authentication on pfSense 2.0 RC1</a></p>
<p>&nbsp;</p>
<h2>Site To Site</h2>
<p>In case that you don’t have a site to site configuration ready, you can check out one of this posts:</p>
<p><a href="http://stefcho.azurewebsites.net/?p=576" target="_blank">Building Site to Site Connection with OpenVPN on pfSense 2.0 RC1 with Shared Key</a></p>
<p><a href="http://stefcho.azurewebsites.net/?p=611" target="_blank">Building Site to Site Connection with OpenVPN on pfSense 2.0 RC1 with PKI</a></p>
<p>&nbsp;</p>
<h1>Advanced Configuration</h1>
<p>On pfSense 01,navigate to VPN &gt; OpenVPN</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/06/Road-Warrior-Config-01.png"><img class="aligncenter size-full wp-image-736" title="Road-Warrior-Config-01" src="https://blog.stefcho.eu/wp-content/uploads/2011/06/Road-Warrior-Config-01.png" alt="" width="580" height="173" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/06/Road-Warrior-Config-01.png 580w, https://blog.stefcho.eu/wp-content/uploads/2011/06/Road-Warrior-Config-01-300x89.png 300w" sizes="(max-width: 580px) 100vw, 580px" /></a></p>
<p>on the Server leaf, in the Road Warrior configuration scroll down to the bottom section titled Advanced Configuration</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/06/Road-Warrior-Config-02.png"><img class="aligncenter size-full wp-image-737" title="Road-Warrior-Config-02" src="https://blog.stefcho.eu/wp-content/uploads/2011/06/Road-Warrior-Config-02.png" alt="" width="915" height="328" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/06/Road-Warrior-Config-02.png 915w, https://blog.stefcho.eu/wp-content/uploads/2011/06/Road-Warrior-Config-02-300x107.png 300w" sizes="(max-width: 915px) 100vw, 915px" /></a></p>
<p>and enter this line:</p>
<blockquote><p>push &#8220;route 10.10.10.0 255.255.255.0&#8221;;</p></blockquote>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/06/Road-Warrior-Config-03.png"><img class="aligncenter size-full wp-image-738" title="Road-Warrior-Config-03" src="https://blog.stefcho.eu/wp-content/uploads/2011/06/Road-Warrior-Config-03.png" alt="" width="912" height="574" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/06/Road-Warrior-Config-03.png 912w, https://blog.stefcho.eu/wp-content/uploads/2011/06/Road-Warrior-Config-03-300x188.png 300w" sizes="(max-width: 912px) 100vw, 912px" /></a></p>
<p>&nbsp;</p>
<p>On pfSense 02, again navigate to VPN &gt; OpenVPN, on the Client leaf, and open the Site To Site configuration</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/06/Site-To-Site-Config-02.png"><img class="aligncenter size-full wp-image-739" title="Site-To-Site-Config-02" src="https://blog.stefcho.eu/wp-content/uploads/2011/06/Site-To-Site-Config-02.png" alt="" width="914" height="378" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/06/Site-To-Site-Config-02.png 914w, https://blog.stefcho.eu/wp-content/uploads/2011/06/Site-To-Site-Config-02-300x124.png 300w" sizes="(max-width: 914px) 100vw, 914px" /></a></p>
<p>Scroll down to the bottom section titled Advanced Configuration, and enter this line:</p>
<blockquote><p>route 10.123.45.0 255.255.255.0;</p></blockquote>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/06/Site-To-Site-Config-03.png"><img class="aligncenter size-full wp-image-740" title="Site-To-Site-Config-03" src="https://blog.stefcho.eu/wp-content/uploads/2011/06/Site-To-Site-Config-03.png" alt="" width="913" height="573" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/06/Site-To-Site-Config-03.png 913w, https://blog.stefcho.eu/wp-content/uploads/2011/06/Site-To-Site-Config-03-300x188.png 300w" sizes="(max-width: 913px) 100vw, 913px" /></a></p>
<h1>Explanation</h1>
<p>As jimp explained in the thread mentioned below,</p>
<p>The <strong>push &#8220;route 10.10.10.0 255.255.255.0&#8221;;</strong> on the Road Warrior configuration tells the client that they can reach machines on the second site via the OpenVPN connection. While establishing connation OpenVPN Client adds an additional route to the second site.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/06/OpenVPN-Client-Route-Print-Result.png"><img class="aligncenter size-full wp-image-741" title="OpenVPN-Client-Route-Print-Result" src="https://blog.stefcho.eu/wp-content/uploads/2011/06/OpenVPN-Client-Route-Print-Result.png" alt="" width="672" height="330" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/06/OpenVPN-Client-Route-Print-Result.png 672w, https://blog.stefcho.eu/wp-content/uploads/2011/06/OpenVPN-Client-Route-Print-Result-300x147.png 300w" sizes="(max-width: 672px) 100vw, 672px" /></a></p>
<p>The <strong>route 10.123.45.0 255.255.255.0;</strong> will instruct the second site how to answer on requests from the OpenVPN Client.</p>
<h1>Testing</h1>
<p>After you save the configuration changes, connect to the Road Warrior, and test you connectivity to machine on both sites.</p>
<h1>References</h1>
<p>While I was configuring similar setup, the routing part was new to me and I found it difficult to grasp at the time, but thanks to jimp’s help on the matter everything is crystal clear.<br />
You can check out the thread in the pfSense forum here:<br />
<a href="http://forum.pfsense.org/index.php/topic,26036.msg135394.html#msg135394" target="_blank">Topic: Routing Road Warrior to Site-To-Site, pfSense as OpenVPN client configuration</a></p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/routing-road-warriors-clients-through-a-site-to-site-vpn-with-pfsense-2-0-rc1-and-openvpn/">Routing Road Warrior’s clients through a Site-To-Site VPN with pfSense 2.0 RC1 and OpenVPN</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></content:encoded>
							<wfw:commentRss>https://blog.stefcho.eu/routing-road-warriors-clients-through-a-site-to-site-vpn-with-pfsense-2-0-rc1-and-openvpn/feed/</wfw:commentRss>
		<slash:comments>7</slash:comments>
							</item>
		<item>
		<title>Packt Publishing OpenVPN 2 Cookbook Review</title>
		<link>https://blog.stefcho.eu/packt-publishing-openvpn-2-cookbook-review/</link>
				<comments>https://blog.stefcho.eu/packt-publishing-openvpn-2-cookbook-review/#comments</comments>
				<pubDate>Sun, 22 May 2011 12:02:20 +0000</pubDate>
		<dc:creator><![CDATA[Stefan]]></dc:creator>
				<category><![CDATA[Technical]]></category>
		<category><![CDATA[Network]]></category>
		<category><![CDATA[OpenVPN]]></category>
		<category><![CDATA[pfSense]]></category>
		<category><![CDATA[PKI]]></category>
		<category><![CDATA[Site To Site]]></category>

		<guid isPermaLink="false">http://stefcho.azurewebsites.net/?p=658</guid>
				<description><![CDATA[<p>OpenVPN 2 Cookbook 100 simple and incredibly effective recipes for harnessing the power of the OpenVPN 2 network By Jan Just Keijser Introduction I was approached by Packt Publishing representative, asking if I would be willing to make a review of this book. This was interesting because at that moment I was reading pfSense 2.0 [&#8230;]</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/packt-publishing-openvpn-2-cookbook-review/">Packt Publishing OpenVPN 2 Cookbook Review</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></description>
								<content:encoded><![CDATA[<h1 style="text-align: center;"><a title="Packt Publishing OpenVPN 2 Cookbook" href="http://www.packtpub.com/openvpn-2-cookbook/book" target="_blank">OpenVPN 2 Cookbook</a></h1>
<p style="text-align: center;">100 simple and incredibly effective recipes for harnessing the power of the OpenVPN 2 network<br />
By Jan Just Keijser</p>
<p style="text-align: center;"><a title="OpenVPN 2 Cookbook" href="http://www.packtpub.com/openvpn-2-cookbook/book" target="_blank"><img class="aligncenter size-full wp-image-660" title="0103OS_OpenVPN 2 Cookbook_FrontCover" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/0103OS_OpenVPN-2-Cookbook_FrontCover.jpg" alt="OpenVPN 2 Cookbook" width="494" height="617" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/0103OS_OpenVPN-2-Cookbook_FrontCover.jpg 494w, https://blog.stefcho.eu/wp-content/uploads/2011/05/0103OS_OpenVPN-2-Cookbook_FrontCover-240x300.jpg 240w" sizes="(max-width: 494px) 100vw, 494px" /></a></p>
<p><strong>Introduction</strong></p>
<p>I was approached by <a title="www.PacktPub.com" href="http://www.PacktPub.com" target="_blank">Packt Publishing</a> representative, asking if I would be willing to make a review of this book. This was interesting because at that moment I was reading <a title="pfSense 2 Cookbook" href="http://www.packtpub.com/pfsense-2-cookbook/book" target="_blank">pfSense 2.0 Cookbook</a> from the same publishing company. I was generously provided with the book, and here we are a month later.</p>
<p>The OpenVPN 2 Cookbook main subject is the use of OpenVPN in different scenarios. Its aim is to help you along the way of implementing an OpenVPN solution. For more detail description take a look at the <a href="http://www.packtpub.com/openvpn-2-cookbook/book#in_detail" target="_blank">detailed description Here</a>.</p>
<p>My experience with OpenVPN is based on three years of different deployments. You can find more details at the bottom of this post.</p>
<p><strong>What’s the book about?</strong></p>
<p>The book is an in depth examination of OpenVPN and how to use is in your every work. If you are in a hurry you can find a quick fix in the huge amount of recipes, or read it from cover to cover and get extensive knowledge of OpenVPN, its capabilities and different usage scenarios.</p>
<p>The book states that prior knowledge and experience of system administration, TCP/IP is required, also in OpenVPN installation. The examples in the book are made mostly on Linux based systems, so prior knowledge in the field is required too.  If you are fresh to field, probably first step is to take a look at <strong><a title="Learning Openvpn 2.0.9" href="https://www.packtpub.com/learning-openvpn-2-0-9/book" target="_blank">Beginning OpenVPN 2.0.9</a></strong> and then continue with this book.</p>
<p>As the cover states: Quick answers to common problems.</p>
<p>The book is structured in twelve chapters, and each chapter consists of about eight to ten sub topics that are called recipes. These recipes are like short How Tos for a particular case. The valuable thing is that throughout the chapter the recipes build on each other, starting from very basic configuration to more advanced ones. To get an impression you can take a look at the <strong><a title="Openvpn 2 Cookbook Table of Contents" href="http://www.packtpub.com/toc/openvpn-2-cookbook-table-contents" target="_blank">Table of Contents</a>.</strong></p>
<p>Every recipe has a <strong>How it works</strong> sections. They are extremely useful to understand what and how is happening behind the scenes. And that’s not all, after this section additional value is provided in the <strong>There’s more</strong> sections, where additional explanations and further developments are delivered.</p>
<p><strong>Does it achieve its promises?</strong></p>
<p>The first topic that really gets me going was <strong>3-way routing</strong> in the first chapter. I was planning to implement this for small number of fixed endpoints which are less than four. For more you have to read further in the book.</p>
<p>The next this that surprise me pleasantly was the PKI, Certificates and OpenSSL chapter. It helped me better understand OpenSSL and give me better idea how to manage certificates. This topic continues in the next chapters about Two-factor Authentication. I was very surprised to see that even hardware tokens can be used to authenticate users.</p>
<p>In The Scripting and Plugins, there is a very important secret about scripts execution, which was not known to me, and definitely will help me in future.</p>
<p>The Troubleshooting sections can save you precious blood, sweat and tears especially with problems related to Routing. Those are the two chapters I appreciate the most because they provide you with analytical way to diagnose and eliminate problems in deployments. You can have a peek in the sample chapter here: <a title="OpenVPN 2 Cookbook Sample Chapter" href="http://www.packtpub.com/sites/default/files/0103chapter7Samplechapter.pdf?utm_source=packtpub&amp;utm_medium=free&amp;utm_campaign=pdf" target="_blank"><strong>Troubleshooting OpenVPN: Configurations</strong></a></p>
<p>Logically after you have fixed all the problems a Performance Tuning is your next step.</p>
<p>The following two chapters are related to OS integrations and advanced configuration. They help me better understand how to better integrate OpenVPN with the unique environment of the client.</p>
<p>The last chapter is all about the new features in 2.2 version of OpenVPN. It is quite useful to have a well arranged section with new features that you might have not known existed up until now.</p>
<p><strong>Conclusion</strong></p>
<p>I really like reading this book, and the systematic knowledge that it provides. Whether you are a full time System Administrator or just a part time occupied with the IT in your company, or just wants to establish a secure connection to your home this book will definitely give you the needed advices how to get there.</p>
<p><strong>Biography</strong></p>
<p>My experience with OpenVPN is based on three years’ of deployments.  My first deployment was on OpenWRT where I had to use predominantly command line to configure it and Secure copy (SCP) for certificate transfer, then on DD-WRT where most of the work is done through the Web GUI, with exemption for more advanced configuration that have to be placed in start-up scripts. After that on I used Windows based systems as clients and servers, and lately as you can see from my blog I’m working with pfSense.</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/packt-publishing-openvpn-2-cookbook-review/">Packt Publishing OpenVPN 2 Cookbook Review</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></content:encoded>
							<wfw:commentRss>https://blog.stefcho.eu/packt-publishing-openvpn-2-cookbook-review/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
							</item>
		<item>
		<title>Building Site to Site Connection with OpenVPN on pfSense 2.0 RC1 with PKI</title>
		<link>https://blog.stefcho.eu/building-site-to-site-connection-with-openvpn-on-pfsense-2-0-rc1-with-pki/</link>
				<comments>https://blog.stefcho.eu/building-site-to-site-connection-with-openvpn-on-pfsense-2-0-rc1-with-pki/#comments</comments>
				<pubDate>Wed, 11 May 2011 20:16:54 +0000</pubDate>
		<dc:creator><![CDATA[Stefan]]></dc:creator>
				<category><![CDATA[Technical]]></category>
		<category><![CDATA[Network]]></category>
		<category><![CDATA[OpenVPN]]></category>
		<category><![CDATA[pfSense]]></category>
		<category><![CDATA[PKI]]></category>
		<category><![CDATA[Site To Site]]></category>

		<guid isPermaLink="false">http://stefcho.azurewebsites.net/?p=611</guid>
				<description><![CDATA[<p>In the last post we’ve setup a Site To Site with Shared Key, now instead we will use internal Certificate Authority. Honestly speaking if I did not follow this guide, there was no routing between the two sites. OpenVPN Site-to-Site PKI (SSL) For reference here is the network diagram: pfsense01 will be out OpenVPN server, [&#8230;]</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/building-site-to-site-connection-with-openvpn-on-pfsense-2-0-rc1-with-pki/">Building Site to Site Connection with OpenVPN on pfSense 2.0 RC1 with PKI</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></description>
								<content:encoded><![CDATA[<p>In the last post we’ve setup a Site To Site with Shared Key, now instead we will use internal Certificate Authority. Honestly speaking if I did not follow this guide, there was no routing between the two sites.<br />
<a href="http://doc.pfsense.org/index.php/OpenVPN_Site-to-Site_PKI_%28SSL%29" target="_blank">OpenVPN Site-to-Site PKI (SSL)</a></p>
<p>For reference here is the network diagram:</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/OpenVPN-Site-to-Site-on-pfSense-2.01.png"><img class="aligncenter size-full wp-image-612" title="OpenVPN Site to Site on pfSense 2.0" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/OpenVPN-Site-to-Site-on-pfSense-2.01.png" alt="" width="746" height="139" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/OpenVPN-Site-to-Site-on-pfSense-2.01.png 746w, https://blog.stefcho.eu/wp-content/uploads/2011/05/OpenVPN-Site-to-Site-on-pfSense-2.01-300x55.png 300w" sizes="(max-width: 746px) 100vw, 746px" /></a></p>
<p>pfsense01 will be out OpenVPN server, and pfsense02 will be our OpenVPN client. Client and Server are just host on the two LANs behind routers.</p>
<p>On pfsense01 go to System &gt; Cert Manager, On CAs leaf create new Certificate Authority.</p>
<p>Enter Descriptive Name, choose as a method Create an internal Certificate Authority, leave Key length and Lifetime to defaults.</p>
<p>Fill in the rest of the fields.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-01-Create-CA-.png"><img class="aligncenter size-full wp-image-614" title="pfsense01 - 01 Create CA" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-01-Create-CA-.png" alt="" width="910" height="632" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-01-Create-CA-.png 910w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-01-Create-CA--300x208.png 300w" sizes="(max-width: 910px) 100vw, 910px" /></a></p>
<p>Then go to Certificates leaf, add new and create the server certificate.</p>
<p>Enter descriptive name, I&#8217;ve used the router host name, as a method choose Create an internal Certificate.</p>
<p>Verify that for Certificate authority the CA that we have created in the previous step is selected. Leave the rest of the fields to default, with exception of Common Name, here enter the host name of the server, in my case it was pfsense01.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-02-Create-Server-Cert-.png"><img class="aligncenter size-full wp-image-615" title="pfsense01 - 02 Create Server Cert" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-02-Create-Server-Cert-.png" alt="" width="904" height="653" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-02-Create-Server-Cert-.png 904w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-02-Create-Server-Cert--300x216.png 300w" sizes="(max-width: 904px) 100vw, 904px" /></a></p>
<p>Now go to System &gt; User manager, create new user. For the sake of simplicity for username I&#8217;ve used the host name of the second router, pfsense02. Enter Password, for Full name I&#8217;ve used again the router name. Then tick the Click to create a user certificate.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-03-Add-user-.png"><img class="aligncenter size-full wp-image-616" title="pfsense01 - 03 Add user" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-03-Add-user-.png" alt="" width="1024" height="741" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-03-Add-user-.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-03-Add-user--300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>For descriptive name use the host name of the router, this is the Common Name of the certificate and it is important to match.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-04-Add-user-.png"><img class="aligncenter size-full wp-image-617" title="pfsense01 - 04 Add user" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-04-Add-user-.png" alt="" width="921" height="607" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-04-Add-user-.png 921w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-04-Add-user--300x197.png 300w" sizes="(max-width: 921px) 100vw, 921px" /></a></p>
<p>Instead of creating new user, you can create new Certificate directly.</p>
<p>Go to Cert Manager, on the Certificate leaf add new. Again as Descriptive name and Common Name use the host name of the second router, in my case pfsense02.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-04.1-Add-user-.png"><img class="aligncenter size-full wp-image-630" title="pfsense01 - 04.1 Add user" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-04.1-Add-user-.png" alt="" width="922" height="663" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-04.1-Add-user-.png 922w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-04.1-Add-user--300x215.png 300w" sizes="(max-width: 922px) 100vw, 922px" /></a></p>
<p>Go to VPN &gt; OpenVPN on the Server leaf, add new.</p>
<p>As Server Mode select Peer to Peer (SSL/TLS). As protocol UDP, Device Mode is TUN, Interface is WAN, leave the port to default 1194. Enter Description, Tick Enable authentication of TLS packets and Automatic generation a shared TLS authentication key.</p>
<p>As Peer Certificate Authority select the CA that we have created in the beginning. I did not have a Peer Certification Revocation List so leave it to None. Select the Server Certificate that we have created. For DH Parameters Length you can leave it to the default 1024 bits. Choose Encryption algorithm in my case BF-CBC (128-bit), take note of the algorithm we have to use the same on the client too.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-05-Setup-OpenVPN-Server-.png"><img class="aligncenter size-full wp-image-618" title="pfsense01 - 05 Setup OpenVPN Server" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-05-Setup-OpenVPN-Server-.png" alt="" width="1024" height="742" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-05-Setup-OpenVPN-Server-.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-05-Setup-OpenVPN-Server--300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>As Tunnel Network choose one different from your LANs, in my case the default 10.0.8.0/24. Enter the Local Network, in my case 10.10.9.0/24. Enter the Remote Network in my case 10.10.10.0/24. Leave the rest to defaults.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-06-Setup-OpenVPN-Server-.png"><img class="aligncenter size-full wp-image-619" title="pfsense01 - 06 Setup OpenVPN Server" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-06-Setup-OpenVPN-Server-.png" alt="" width="1024" height="742" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-06-Setup-OpenVPN-Server-.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-06-Setup-OpenVPN-Server--300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Go to VPN &gt; OpenVPN in Client Specific Overrides, and add new entry for the client.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-11-Configure-Client-Specific-Override.png"><img class="aligncenter size-full wp-image-620" title="pfsense01 - 11 Configure Client Specific Override" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-11-Configure-Client-Specific-Override.png" alt="" width="916" height="320" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-11-Configure-Client-Specific-Override.png 916w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-11-Configure-Client-Specific-Override-300x104.png 300w" sizes="(max-width: 916px) 100vw, 916px" /></a></p>
<p>For Common name enter the host name of the second router that we have used as common name in the certificate, in my case pfsense02. Enter some description, and the Tunnel Network, in my case 10.0.8.0/24. Leave the rest to default.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-12-Configure-Client-Specific-Override.png"><img class="aligncenter size-full wp-image-621" title="pfsense01 - 12 Configure Client Specific Override" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-12-Configure-Client-Specific-Override.png" alt="" width="1024" height="742" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-12-Configure-Client-Specific-Override.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-12-Configure-Client-Specific-Override-300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>In the Advanced form, enter</p>
<blockquote><p>iroute 10.10.10.0 255.255.255.0</p></blockquote>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-13-Configure-Client-Specific-Override.png"><img class="aligncenter size-full wp-image-622" title="pfsense01 - 13 Configure Client Specific Override" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-13-Configure-Client-Specific-Override.png" alt="" width="909" height="580" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-13-Configure-Client-Specific-Override.png 909w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-13-Configure-Client-Specific-Override-300x191.png 300w" sizes="(max-width: 909px) 100vw, 909px" /></a>Without this step there will be no routing between the two LANs.</p>
<p>Got to Firewall &gt;Rules and on the OpenVPN leaf, add new rule.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-08-Add-Rule-to-Allow-Traffic.png"><img class="aligncenter size-full wp-image-623" title="pfsense01 - 08 Add Rule to Allow Traffic" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-08-Add-Rule-to-Allow-Traffic.png" alt="" width="913" height="480" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-08-Add-Rule-to-Allow-Traffic.png 913w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-08-Add-Rule-to-Allow-Traffic-300x157.png 300w" sizes="(max-width: 913px) 100vw, 913px" /></a><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-09-Add-Rule-to-Allow-Traffic.png"></a></p>
<p>Here for testing purposes I&#8217;ve made allow all rule. Select any as Protocol, leave the rest to default and enter description.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-09-Add-Rule-to-Allow-Traffic.png"><img class="aligncenter size-full wp-image-624" title="pfsense01 - 09 Add Rule to Allow Traffic" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-09-Add-Rule-to-Allow-Traffic.png" alt="" width="1024" height="741" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-09-Add-Rule-to-Allow-Traffic.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-09-Add-Rule-to-Allow-Traffic-300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>For the client to be able to connect, let&#8217;s open the OpenVPN Server port.</p>
<p>In Firewall &gt; Rules on the WAN leaf, add new rule. Select UDP as Protocol.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-09-Add-Rule-to-Open-VPN-Port-Port.png"><img class="aligncenter size-full wp-image-627" title="pfsense01 - 09 Add Rule to Open VPN Port Port" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-09-Add-Rule-to-Open-VPN-Port-Port.png" alt="" width="1024" height="741" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-09-Add-Rule-to-Open-VPN-Port-Port.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-09-Add-Rule-to-Open-VPN-Port-Port-300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>As Destination port Range in our case select OpenVPN.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-10-Add-Rule-to-Open-VPN-Port-Port.png"><img class="aligncenter size-full wp-image-625" title="pfsense01 - 10 Add Rule to Open VPN Port Port" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-10-Add-Rule-to-Open-VPN-Port-Port.png" alt="" width="912" height="625" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-10-Add-Rule-to-Open-VPN-Port-Port.png 912w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-10-Add-Rule-to-Open-VPN-Port-Port-300x205.png 300w" sizes="(max-width: 912px) 100vw, 912px" /></a></p>
<p>Now it is time to export certificate for use on the second router.</p>
<p>Go back to System &gt; Cert manager export public and private CA certs, click on the first downward pointing triangle. As a guide, when you hoover over it the text label is Export CA.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-07-Export-CA-Cert-.png"><img class="aligncenter size-full wp-image-628" title="pfsense01 - 07 Export CA Cert" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-07-Export-CA-Cert-.png" alt="" width="920" height="340" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-07-Export-CA-Cert-.png 920w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-07-Export-CA-Cert--300x110.png 300w" sizes="(max-width: 920px) 100vw, 920px" /></a></p>
<p>Then go to User Manager, enter the configuration of our user pfsense02, in the User Certificates section click on both downward pointing triangles to download both cert and key.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-08-Export-User-Cert.png"><img class="aligncenter size-full wp-image-629" title="pfsense01 - 08 Export User Cert" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-08-Export-User-Cert.png" alt="" width="913" height="532" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-08-Export-User-Cert.png 913w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense01-08-Export-User-Cert-300x174.png 300w" sizes="(max-width: 913px) 100vw, 913px" /></a></p>
<p>&nbsp;</p>
<p>Now on pfSense02, go to System &gt; Cert Manager on CAs leaf, add new one.</p>
<p>And as Method select Import an existing Certificate Authority. Enter as Descriptive name the name of the certificate from the first server, in my case pfsense01.</p>
<p>You have to have opened the certificate with notepad, or another text editor. Then simply copy / paste the content of the file.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-01.1-Import-CA-Cert.png"><img class="aligncenter size-full wp-image-633" title="pfsense02 - 01.1 Import CA Cert" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-01.1-Import-CA-Cert.png" alt="" width="921" height="692" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-01.1-Import-CA-Cert.png 921w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-01.1-Import-CA-Cert-300x225.png 300w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-01.1-Import-CA-Cert-200x150.png 200w" sizes="(max-width: 921px) 100vw, 921px" /></a></p>
<p>Now on the Certificate leaf do the same but paste and the content of the&nbsp; *.key in Private key data. Again enter Descriptive name as the one from the first router.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-02-Import-User-Cert.png"><img class="aligncenter size-full wp-image-632" title="pfsense02 - 02 Import User Cert" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-02-Import-User-Cert.png" alt="" width="910" height="635" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-02-Import-User-Cert.png 910w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-02-Import-User-Cert-300x209.png 300w" sizes="(max-width: 910px) 100vw, 910px" /></a></p>
<p>Go to VPN &gt; OpenVPN in Client leaf and add new</p>
<p>As Server Mode select Peer to Peer (SSL/TLS), Protocol is UDP, Device mode is TUN, and Interface is WAN. For Server host or address enter the WAN IP of pfsense01, in my case 10.10.2.2 and enter the port. Put some Description.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-03-Setup-OpenVPN-Client.png"><img class="aligncenter size-full wp-image-634" title="pfsense02 - 03 Setup OpenVPN Client" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-03-Setup-OpenVPN-Client.png" alt="" width="1024" height="741" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-03-Setup-OpenVPN-Client.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-03-Setup-OpenVPN-Client-300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Open the Server configuration (VPN &gt; OpenVPN &gt; Server leaf) on pfsense01, copy the TLS Authentication.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-04-Copy-PreShared-Key-From-pfsense01.png"><img class="aligncenter size-full wp-image-635" title="pfsense02 - 04 Copy PreShared Key From pfsense01" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-04-Copy-PreShared-Key-From-pfsense01.png" alt="" width="1024" height="740" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-04-Copy-PreShared-Key-From-pfsense01.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-04-Copy-PreShared-Key-From-pfsense01-300x216.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-05-Paste-PreShared-Key-From-pfsense01.png"></a></p>
<p>Paste it in the TLS Authentication form on our client configuration on pfsense02. Unpick Automatically generate a shared TLS authentication key and leave Enable authentication of TLS packets. <a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-05-Paste-PreShared-Key-From-pfsense01.png"><img class="aligncenter size-full wp-image-636" title="pfsense02 - 05 Paste PreShared Key From pfsense01" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-05-Paste-PreShared-Key-From-pfsense01.png" alt="" width="1024" height="743" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-05-Paste-PreShared-Key-From-pfsense01.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-05-Paste-PreShared-Key-From-pfsense01-300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-06-Setup-OpenVPN-Client.png"></a></p>
<p>Use the same Tunnel Network as on the server, in my case 10.0.8.0/24. Enter Remote Network, this is the network behind pfsense01, for this case 10.10.9.0/24.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-06-Setup-OpenVPN-Client.png"><img class="aligncenter size-full wp-image-637" title="pfsense02 - 06 Setup OpenVPN Client" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-06-Setup-OpenVPN-Client.png" alt="" width="913" height="643" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-06-Setup-OpenVPN-Client.png 913w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-06-Setup-OpenVPN-Client-300x211.png 300w" sizes="(max-width: 913px) 100vw, 913px" /></a></p>
<p>Add Allow All rule in Firewall &gt; Rules on the OpenVPN leaf.</p>
<p>Now go to Status &gt; OpenVPN and you should see that the connection is established.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-07-Verify-Connectivity-on-Client.png"><img class="aligncenter size-full wp-image-638" title="pfsense02 - 07 Verify Connectivity on Client" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-07-Verify-Connectivity-on-Client.png" alt="" width="1024" height="258" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-07-Verify-Connectivity-on-Client.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-07-Verify-Connectivity-on-Client-300x75.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-07-Verify-Connectivity-on-Server.png"></a></p>
<p>From the Server prospective, again on Status &gt; OpenVPN.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-07-Verify-Connectivity-on-Server.png"><img class="aligncenter size-full wp-image-639" title="pfsense02 - 07 Verify Connectivity on Server" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-07-Verify-Connectivity-on-Server.png" alt="" width="1024" height="257" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-07-Verify-Connectivity-on-Server.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/pfsense02-07-Verify-Connectivity-on-Server-300x75.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Now you should be able to access hosts from the other network successfully.</p>
<p>&nbsp;</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/building-site-to-site-connection-with-openvpn-on-pfsense-2-0-rc1-with-pki/">Building Site to Site Connection with OpenVPN on pfSense 2.0 RC1 with PKI</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></content:encoded>
							<wfw:commentRss>https://blog.stefcho.eu/building-site-to-site-connection-with-openvpn-on-pfsense-2-0-rc1-with-pki/feed/</wfw:commentRss>
		<slash:comments>10</slash:comments>
							</item>
		<item>
		<title>Building Site to Site Connection with OpenVPN on pfSense 2.0 RC1 with Shared Key</title>
		<link>https://blog.stefcho.eu/building-site-to-site-connection-with-openvpn-on-pfsense-2-0-rc1-with-shared-key/</link>
				<comments>https://blog.stefcho.eu/building-site-to-site-connection-with-openvpn-on-pfsense-2-0-rc1-with-shared-key/#comments</comments>
				<pubDate>Mon, 02 May 2011 00:28:11 +0000</pubDate>
		<dc:creator><![CDATA[Stefan]]></dc:creator>
				<category><![CDATA[Technical]]></category>
		<category><![CDATA[Network]]></category>
		<category><![CDATA[OpenVPN]]></category>
		<category><![CDATA[pfSense]]></category>
		<category><![CDATA[Site To Site]]></category>

		<guid isPermaLink="false">http://stefcho.azurewebsites.net/?p=576</guid>
				<description><![CDATA[<p>&#160; Sooner or later you will have two or more geographically distant LAN that you want to connect together. Whether we are speaking about to branch offices or home and office, or simply your office LAN and some co located servers in a data center, it is only a matter of time before you need [&#8230;]</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/building-site-to-site-connection-with-openvpn-on-pfsense-2-0-rc1-with-shared-key/">Building Site to Site Connection with OpenVPN on pfSense 2.0 RC1 with Shared Key</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></description>
								<content:encoded><![CDATA[<p>&nbsp;</p>
<p>Sooner or later you will have two or more geographically distant LAN that you want to connect together. Whether we are speaking about to branch offices or home and office, or simply your office LAN and some co located servers in a data center, it is only a matter of time before you need such solution.</p>
<p>In this case we will use two pfSense 2.0 RC1, one in each remote location.</p>
<p>The map shows our lab setup for the purpose.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/OpenVPN-Site-to-Site-on-pfSense-2.0.png"><img class="aligncenter size-full wp-image-577" title="OpenVPN Site to Site on pfSense 2.0" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/OpenVPN-Site-to-Site-on-pfSense-2.0.png" alt="" width="746" height="139" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/OpenVPN-Site-to-Site-on-pfSense-2.0.png 746w, https://blog.stefcho.eu/wp-content/uploads/2011/05/OpenVPN-Site-to-Site-on-pfSense-2.0-300x55.png 300w" sizes="(max-width: 746px) 100vw, 746px" /></a></p>
<p>In this post we will use Shared Key as a way to authenticate the two routers.</p>
<p>On pfSense01, this machine will play the role of server in this scenario.</p>
<p>Go to VPN &gt; OpenVPN, on the Server leaf, add new one<a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-01-OpenVPN-Conifuration.png"><img class="aligncenter size-full wp-image-578" title="Configure pfsense01 as a Server - 01 - OpenVPN Conifuration" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-01-OpenVPN-Conifuration.png" alt="" width="1024" height="369" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-01-OpenVPN-Conifuration.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-01-OpenVPN-Conifuration-300x108.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>As Server Mode choose <strong>Peer to Peer (Shared key)</strong></p>
<p>Protocol, Device Mode, Interface, Local port &#8211; you can leaf the default for now.</p>
<p>Description &#8211; Enter whatever is informative for you.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-02-OpenVPN-Conifuration.png"><img class="aligncenter size-full wp-image-579" title="Configure pfsense01 as a Server - 02 - OpenVPN Conifuration" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-02-OpenVPN-Conifuration.png" alt="" width="1024" height="741" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-02-OpenVPN-Conifuration.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-02-OpenVPN-Conifuration-300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a>Encryption algorithm, choose one by your preference, keep in mind that different algorithms have different load on the server. I use BF-CBC (128-bit)</p>
<p>&nbsp;</p>
<p>Choose different from both of your LAN subnets for Tunnel Network, in our case 10.0.8.0/24.</p>
<p>Local Network – The LAN behind the pfSense01, in this example 10.10.9.0/24.</p>
<p>Remote Network – this is the LAN behind the pfSense02, as on the diagram 10.10.10.0/24.</p>
<p>Click on Save button and we are Done.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-03-OpenVPN-Conifuration.png"><img class="aligncenter size-full wp-image-580" title="Configure pfsense01 as a Server - 03 - OpenVPN Conifuration" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-03-OpenVPN-Conifuration.png" alt="" width="1024" height="740" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-03-OpenVPN-Conifuration.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-03-OpenVPN-Conifuration-300x216.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Open the newly configured server and copy the Shared Key. We will need it for the setup of pfSense02.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-04-OpenVPN-Conifuration.png"><img class="aligncenter size-full wp-image-581" title="Configure pfsense01 as a Server - 04 - OpenVPN Conifuration" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-04-OpenVPN-Conifuration.png" alt="" width="1024" height="741" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-04-OpenVPN-Conifuration.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-04-OpenVPN-Conifuration-300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Go to Firewall &gt; Rules, on the WAN leaf, add new rule</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-05-Network-Rules.png"><img class="aligncenter size-full wp-image-582" title="Configure pfsense01 as a Server - 05 - Network Rules" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-05-Network-Rules.png" alt="" width="1024" height="221" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-05-Network-Rules.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-05-Network-Rules-300x64.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-05.5-Network-Rules.png"><img class="aligncenter size-full wp-image-584" title="Configure pfsense01 as a Server - 05.5 - Network Rules" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-05.5-Network-Rules.png" alt="" width="1024" height="367" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-05.5-Network-Rules.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-05.5-Network-Rules-300x107.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a>The Action is Pass, Select WAN as Interface, UDP as Protocol.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-06-Network-Rules-WAN.png"><img class="aligncenter size-full wp-image-583" title="Configure pfsense01 as a Server - 06 - Network Rules - WAN" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-06-Network-Rules-WAN.png" alt="" width="1024" height="741" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-06-Network-Rules-WAN.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-06-Network-Rules-WAN-300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>For Destination port range, select OpenVPN in our case it is 1194, if you have used some other port in the configuration enter it here. Enter some description also. <a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-07-Network-Rules.png"><img class="aligncenter size-full wp-image-585" title="Configure pfsense01 as a Server - 07 - Network Rules" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-07-Network-Rules.png" alt="" width="1024" height="739" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-07-Network-Rules.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-07-Network-Rules-300x216.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Go to the OpenVPN leaf. Here I have made a very basic Allow All rule. If you have some security concerns, or want to limit the communication between the two sites, make one or more rules to fit your need.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-08-Network-Rules-OpenVPN.png"><img class="aligncenter size-full wp-image-586" title="Configure pfsense01 as a Server - 08 - Network Rules OpenVPN" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-08-Network-Rules-OpenVPN.png" alt="" width="1024" height="740" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-08-Network-Rules-OpenVPN.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-08-Network-Rules-OpenVPN-300x216.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-09-Network-Rules-OpenVPN.png"><img class="aligncenter size-full wp-image-587" title="Configure pfsense01 as a Server - 09 - Network Rules OpenVPN" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-09-Network-Rules-OpenVPN.png" alt="" width="1024" height="741" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-09-Network-Rules-OpenVPN.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-09-Network-Rules-OpenVPN-300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>&nbsp;</p>
<p>pfSense02 will play the role of client.</p>
<p>Go to VPN &gt; OpenVPN, on the Client leaf, add new one</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense01-as-a-Server-09-Network-Rules-OpenVPN1.png"></a><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-01-OpenVPN-confiugration.png"></a><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-01-OpenVPN-confiugration1.png"><img class="aligncenter size-full wp-image-590" title="Configure pfsense02 as a Client - 01 - OpenVPN confiugration" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-01-OpenVPN-confiugration1.png" alt="" width="1024" height="379" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-01-OpenVPN-confiugration1.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-01-OpenVPN-confiugration1-300x111.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>As Server Mode choose <strong>Peer to Peer (Shared key)</strong></p>
<p>Protocol, match the one from the server in our case UDP, Device mode – tun, Interface is WAN, Local port, leave empty for random, or enter manually one if you want.</p>
<p>Server host or address, enter the WAN IP address on the first router pfSense01, in our case 10.10.2.2. Server port, whatever port you have used on the server, in our case the default 1194.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-02-OpenVPN-confiugration.png"><img class="aligncenter size-full wp-image-591" title="Configure pfsense02 as a Client - 02 - OpenVPN confiugration" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-02-OpenVPN-confiugration.png" alt="" width="1024" height="741" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-02-OpenVPN-confiugration.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-02-OpenVPN-confiugration-300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Enter Description. For Shared Key, paste the one from the pfSense01 here. Encryption algorithm, duplicate the one from the first configuration, in our case BF-CBC (128-bit).</p>
<p>Tunnel Network, duplicate the one from the server. Remote Network is the LAN network behind the pfSense01, for our example 10.10.9.0/24.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-03-OpenVPN-confiugration.png"><img class="aligncenter size-full wp-image-592" title="Configure pfsense02 as a Client - 03 - OpenVPN confiugration" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-03-OpenVPN-confiugration.png" alt="" width="1024" height="740" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-03-OpenVPN-confiugration.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-03-OpenVPN-confiugration-300x216.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Leave the rest to default, and Save the configuration.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-04-OpenVPN-confiugration.png"><img class="aligncenter size-full wp-image-593" title="Configure pfsense02 as a Client - 04 - OpenVPN confiugration" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-04-OpenVPN-confiugration.png" alt="" width="1024" height="739" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-04-OpenVPN-confiugration.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-04-OpenVPN-confiugration-300x216.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Again add a rule on the OpenVPN leaf in the Firewall &gt; Rules section to allow traffic flow between the two sites. Here again I&#8217;ve setup a rule that Allow All traffic between the two sites.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-05-OpenVPN-Rule.png"><img class="aligncenter size-full wp-image-596" title="Configure pfsense02 as a Client - 05 - OpenVPN Rule" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-05-OpenVPN-Rule.png" alt="" width="1024" height="456" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-05-OpenVPN-Rule.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-05-OpenVPN-Rule-300x133.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Now go to Status &gt; OpenVPN. You should see that Status equals UP.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-05-OpenVPN-Status.png"><img class="aligncenter size-full wp-image-594" title="Configure pfsense02 as a Client - 05 - OpenVPN Status" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-05-OpenVPN-Status.png" alt="" width="1024" height="418" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-05-OpenVPN-Status.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-05-OpenVPN-Status-300x122.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-06-OpenVPN-Status.png"><img class="aligncenter size-full wp-image-595" title="Configure pfsense02 as a Client - 06 - OpenVPN Status" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-06-OpenVPN-Status.png" alt="" width="1024" height="254" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-06-OpenVPN-Status.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/05/Configure-pfsense02-as-a-Client-06-OpenVPN-Status-300x74.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a>Now you should be able to successfully communicate with hosts from the other network.</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/building-site-to-site-connection-with-openvpn-on-pfsense-2-0-rc1-with-shared-key/">Building Site to Site Connection with OpenVPN on pfSense 2.0 RC1 with Shared Key</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></content:encoded>
							<wfw:commentRss>https://blog.stefcho.eu/building-site-to-site-connection-with-openvpn-on-pfsense-2-0-rc1-with-shared-key/feed/</wfw:commentRss>
		<slash:comments>11</slash:comments>
							</item>
		<item>
		<title>OpenVPN with RADIUS authentication on pfSense 2.0 RC1</title>
		<link>https://blog.stefcho.eu/openvpn-with-radius-authentication-on-pfsense-2-0-rc1/</link>
				<comments>https://blog.stefcho.eu/openvpn-with-radius-authentication-on-pfsense-2-0-rc1/#comments</comments>
				<pubDate>Tue, 26 Apr 2011 14:32:32 +0000</pubDate>
		<dc:creator><![CDATA[Stefan]]></dc:creator>
				<category><![CDATA[Technical]]></category>
		<category><![CDATA[ADDS]]></category>
		<category><![CDATA[OpenVPN]]></category>
		<category><![CDATA[pfSense]]></category>
		<category><![CDATA[RADIUS]]></category>
		<category><![CDATA[Windows Server 2008 R2]]></category>

		<guid isPermaLink="false">http://stefcho.azurewebsites.net/?p=545</guid>
				<description><![CDATA[<p>This is the last post in the series of authentication alternatives for OpenVPN in pfSense 2.0 RC1. In the previous posts we looked at the local database of pfSense and Active Directory. Now we will use Remote Authentication Dial In User Service (RADIUS) instead. Again we will authenticate our users against Active Directory, as domain [&#8230;]</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/openvpn-with-radius-authentication-on-pfsense-2-0-rc1/">OpenVPN with RADIUS authentication on pfSense 2.0 RC1</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></description>
								<content:encoded><![CDATA[<p>This is the last post in the series of authentication alternatives for OpenVPN in pfSense 2.0 RC1.</p>
<p>In the previous posts we looked at the <a href="http://stefcho.azurewebsites.net/?p=492" target="_blank">local database</a> of pfSense and <a href="http://stefcho.azurewebsites.net/?p=528" target="_blank">Active Directory</a>. Now we will use Remote Authentication Dial In User Service (RADIUS) instead. Again we will authenticate our users against Active Directory, as domain user accounts.</p>
<p>For that purpose we need to add <strong>Network Policy and Access Services</strong> server role to our Windows Server 2008 R2.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/ADDS-Add-NPS-roles-02.png"><img class="aligncenter size-full wp-image-546" title="ADDS Add NPS roles 02" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/ADDS-Add-NPS-roles-02.png" alt="" width="801" height="576" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/ADDS-Add-NPS-roles-02.png 801w, https://blog.stefcho.eu/wp-content/uploads/2011/04/ADDS-Add-NPS-roles-02-300x215.png 300w" sizes="(max-width: 801px) 100vw, 801px" /></a></p>
<p>From the Role services select only the<strong> Network Policy Server</strong>. We don’t need any of the other services.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/ADDS-Add-NPS-roles-03.png"><img class="aligncenter size-full wp-image-547" title="ADDS Add NPS roles 03" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/ADDS-Add-NPS-roles-03.png" alt="" width="801" height="577" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/ADDS-Add-NPS-roles-03.png 801w, https://blog.stefcho.eu/wp-content/uploads/2011/04/ADDS-Add-NPS-roles-03-300x216.png 300w" sizes="(max-width: 801px) 100vw, 801px" /></a></p>
<p>After the successful installation, open the Network Policy Server console. Under RADIUS Clients and Servers, create new RADIUS Client.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-add-new-RADIUS-Client-01.png"><img class="aligncenter size-full wp-image-548" title="NPS add new RADIUS Client 01" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-add-new-RADIUS-Client-01.png" alt="" width="1024" height="244" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-add-new-RADIUS-Client-01.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-add-new-RADIUS-Client-01-300x71.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a>Take note of the Friendly name of the client, we will use is later in the Network Policy. In our case pfSense.</p>
<p>Enter the LAN address of pfSense, and Shared secret.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-add-new-RADIUS-Client-02-Details.png"><img class="aligncenter size-full wp-image-549" title="NPS add new RADIUS Client 02 Details" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-add-new-RADIUS-Client-02-Details.png" alt="" width="746" height="654" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-add-new-RADIUS-Client-02-Details.png 746w, https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-add-new-RADIUS-Client-02-Details-300x263.png 300w" sizes="(max-width: 746px) 100vw, 746px" /></a></p>
<p>Leave the default configuration on the Advanced leaf.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-add-new-RADIUS-Client-03-Details.png"><img class="aligncenter size-full wp-image-550" title="NPS add new RADIUS Client 03 Details" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-add-new-RADIUS-Client-03-Details.png" alt="" width="745" height="656" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-add-new-RADIUS-Client-03-Details.png 745w, https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-add-new-RADIUS-Client-03-Details-300x264.png 300w" sizes="(max-width: 745px) 100vw, 745px" /></a></p>
<p>We won’t configure additional Connection request Polies.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-Connection-Request-Poliocies.png"><img class="aligncenter size-full wp-image-551" title="NPS Connection Request Poliocies" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-Connection-Request-Poliocies.png" alt="" width="1024" height="768" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-Connection-Request-Poliocies.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-Connection-Request-Poliocies-300x225.png 300w, https://blog.stefcho.eu/wp-content/uploads/2011/04/NPS-Connection-Request-Poliocies-200x150.png 200w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>A new Network Policy is needed, because the default<strong> Connections to other access servers</strong> block requests send by pfSense.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-01.png"><img class="aligncenter size-full wp-image-552" title="Network Policies New 01" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-01.png" alt="" width="1024" height="768" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-01.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-01-300x225.png 300w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-01-200x150.png 200w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Enter Policy name of your preference, and leave the default Type of network access server to Unspecified. Otherwise your authentication request will be denied.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-02.png"><img class="aligncenter size-full wp-image-553" title="Network Policies New 02" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-02.png" alt="" width="687" height="588" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-02.png 687w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-02-300x256.png 300w" sizes="(max-width: 687px) 100vw, 687px" /></a>For Condition, let’s add the Client Friendly Name. In our case the client is our pfSense router. Type in here the Friendly name that you used in the RADIUS Client configuration. In our case pfSense.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-04.png"></a><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-05.png"><img class="aligncenter size-full wp-image-555" title="Network Policies New 05" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-05.png" alt="" width="686" height="589" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-05.png 686w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-05-300x257.png 300w" sizes="(max-width: 686px) 100vw, 686px" /></a><br />
On Specify Access Permission, leave Access granted.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-06.png"><img class="aligncenter size-full wp-image-556" title="Network Policies New 06" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-06.png" alt="" width="689" height="586" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-06.png 689w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-06-300x255.png 300w" sizes="(max-width: 689px) 100vw, 689px" /></a></p>
<p>As Authentication Methods add Unencrypted authentication (PAP, SPAP). The explanation follows later.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-07.png"><img class="aligncenter size-full wp-image-557" title="Network Policies New 07" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-07.png" alt="" width="688" height="586" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-07.png 688w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-07-300x255.png 300w" sizes="(max-width: 688px) 100vw, 688px" /></a>Leave constraints to defaults, if you don’t have some specific requirements. The same is valid for Settings too.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-08.png"><img class="aligncenter size-full wp-image-558" title="Network Policies New 08" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-08.png" alt="" width="687" height="585" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-08.png 687w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-08-300x255.png 300w" sizes="(max-width: 687px) 100vw, 687px" /></a><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-09.png"><img class="aligncenter size-full wp-image-559" title="Network Policies New 09" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-09.png" alt="" width="687" height="588" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-09.png 687w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-09-300x256.png 300w" sizes="(max-width: 687px) 100vw, 687px" /></a></p>
<p>All done</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-10.png"><img class="aligncenter size-full wp-image-560" title="Network Policies New 10" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-10.png" alt="" width="690" height="588" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-10.png 690w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-10-300x255.png 300w" sizes="(max-width: 690px) 100vw, 690px" /></a><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-11.png"><img class="aligncenter size-full wp-image-561" title="Network Policies New 11" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-11.png" alt="" width="1024" height="768" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-11.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-11-300x225.png 300w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Network-Policies-New-11-200x150.png 200w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>On your pfSense go to System &gt; User Management &gt; Servers add new.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-Configure-RADIUS-Authentication-01.png"><img class="aligncenter size-full wp-image-562" title="pfSense Configure RADIUS Authentication 01" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-Configure-RADIUS-Authentication-01.png" alt="" width="1024" height="680" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-Configure-RADIUS-Authentication-01.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-Configure-RADIUS-Authentication-01-300x199.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Enter descriptive name of your liking. As type select Radius. Enter the IP address of the server that we just configure to be our RADIUS server. Under Services offered, leave the default Authentication and Accounting. Take note that we have not configured accounting on our NPS service, but you could easily enable it. The default ports are fine. If you have Windows Firewall, or some other kind of firewall service running, make sure required ports are open.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-Configure-RADIUS-Authentication-02.png"><img class="aligncenter size-full wp-image-563" title="pfSense Configure RADIUS Authentication 02" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-Configure-RADIUS-Authentication-02.png" alt="" width="1024" height="702" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-Configure-RADIUS-Authentication-02.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-Configure-RADIUS-Authentication-02-300x205.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>It is time to go to your OpenVPN Server configuration and select our new RADIUS provider as <strong>Backend for authentication</strong>.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-OpenVPN-Server-Authentication-configuration.png"><img class="aligncenter size-full wp-image-564" title="pfSense OpenVPN Server Authentication configuration" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-OpenVPN-Server-Authentication-configuration.png" alt="" width="1024" height="549" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-OpenVPN-Server-Authentication-configuration.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-OpenVPN-Server-Authentication-configuration-300x160.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Now if you make test connection with test user, take a look at the security logs on the RADIUS server.</p>
<p>You will see RADIUS Client Friendly Name match out configuration, and which Policies were used,<a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Verify-Successful-connection-in-the-Security-Logs-02.png"><img class="aligncenter size-full wp-image-565" title="Verify Successful connection in  the  Security Logs 02" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/Verify-Successful-connection-in-the-Security-Logs-02.png" alt="" width="1024" height="768" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/Verify-Successful-connection-in-the-Security-Logs-02.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Verify-Successful-connection-in-the-Security-Logs-02-300x225.png 300w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Verify-Successful-connection-in-the-Security-Logs-02-200x150.png 200w" sizes="(max-width: 1024px) 100vw, 1024px" /></a>and that the Authentication Type is PAP, that is why we added it to the policy earlier.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Verify-Successful-connection-in-the-Security-Logs-04.png"><img class="aligncenter size-full wp-image-566" title="Verify Successful connection in  the  Security Logs 04" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/Verify-Successful-connection-in-the-Security-Logs-04.png" alt="" width="1024" height="768" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/Verify-Successful-connection-in-the-Security-Logs-04.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Verify-Successful-connection-in-the-Security-Logs-04-300x225.png 300w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Verify-Successful-connection-in-the-Security-Logs-04-200x150.png 200w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>That’s it.</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/openvpn-with-radius-authentication-on-pfsense-2-0-rc1/">OpenVPN with RADIUS authentication on pfSense 2.0 RC1</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></content:encoded>
							<wfw:commentRss>https://blog.stefcho.eu/openvpn-with-radius-authentication-on-pfsense-2-0-rc1/feed/</wfw:commentRss>
		<slash:comments>5</slash:comments>
							</item>
		<item>
		<title>OpenVPN with LDAP authentication on pfSense 2.0 RC1</title>
		<link>https://blog.stefcho.eu/openvpn-with-ldap-authentication-on-pfsense-2-0-rc1/</link>
				<comments>https://blog.stefcho.eu/openvpn-with-ldap-authentication-on-pfsense-2-0-rc1/#comments</comments>
				<pubDate>Fri, 22 Apr 2011 11:20:56 +0000</pubDate>
		<dc:creator><![CDATA[Stefan]]></dc:creator>
				<category><![CDATA[Technical]]></category>
		<category><![CDATA[ADDS]]></category>
		<category><![CDATA[LDAP]]></category>
		<category><![CDATA[OpenVPN]]></category>
		<category><![CDATA[pfSense]]></category>
		<category><![CDATA[Windows Server 2008 R2]]></category>

		<guid isPermaLink="false">http://stefcho.azurewebsites.net/?p=528</guid>
				<description><![CDATA[<p>In the last post I’ve used Local User Database for authentication with the OpenVPN Server, but managing users in multiple places is redundant and should be avoided. If your users resides in Windows Domain why not use a Domain Controller for authenticating VPN users. That’s way now we will use Active Directory. For the purpose [&#8230;]</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/openvpn-with-ldap-authentication-on-pfsense-2-0-rc1/">OpenVPN with LDAP authentication on pfSense 2.0 RC1</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></description>
								<content:encoded><![CDATA[<p>In the last post I’ve used Local User Database for authentication with the OpenVPN Server, but managing users in multiple places is redundant and should be avoided. If your users resides in Windows Domain why not use a Domain Controller for authenticating VPN users.</p>
<p>That’s way now we will use Active Directory.</p>
<p>For the purpose I’ve setup a Windows Server with Active Directory Domain Services. In a new Organization Unit called Test Users, there are a service account (domain\vpnsvc), and user account with witch we’ll do the tests (domain\user2).</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/ADDS-OU-with-Users.png"><img class="aligncenter size-full wp-image-529" title="ADDS OU with Users" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/ADDS-OU-with-Users.png" alt="" width="554" height="245" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/ADDS-OU-with-Users.png 554w, https://blog.stefcho.eu/wp-content/uploads/2011/04/ADDS-OU-with-Users-300x132.png 300w" sizes="(max-width: 554px) 100vw, 554px" /></a></p>
<p>On the pfSense go to System &gt; User Manager &gt; Servers</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers.png"><img class="aligncenter size-full wp-image-530" title="pfSense 2.0 System Authentication Servers" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers.png" alt="" width="1024" height="339" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers-300x99.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a><br />
Add new one with the + sign button.</p>
<p>For Type select LDAP<br />
Enter the IP address of your Domain Controller</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers-Configure-LDAP.png"><img class="aligncenter size-full wp-image-531" title="pfSense 2.0 System Authentication Servers - Configure LDAP" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers-Configure-LDAP.png" alt="" width="1024" height="768" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers-Configure-LDAP.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers-Configure-LDAP-300x225.png 300w, https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers-Configure-LDAP-200x150.png 200w" sizes="(max-width: 1024px) 100vw, 1024px" /></a><br />
In the Search scope, you have to enter the Base DN, you can find it by using ADSI Edit.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/ADSI-Edit-Domain.png"><img class="aligncenter size-full wp-image-532" title="ADSI Edit Domain" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/ADSI-Edit-Domain.png" alt="" width="1024" height="204" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/ADSI-Edit-Domain.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/ADSI-Edit-Domain-300x59.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a><br />
Now for Authentication containers, click on Select button and choose the ones in which users that will have access through VPN are.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers-Configure-LDAP-Select-Authentication-Containers.png"><img class="aligncenter size-full wp-image-533" title="pfSense 2.0 System Authentication Servers - Configure LDAP - Select Authentication Containers" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers-Configure-LDAP-Select-Authentication-Containers.png" alt="" width="1024" height="768" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers-Configure-LDAP-Select-Authentication-Containers.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers-Configure-LDAP-Select-Authentication-Containers-300x225.png 300w, https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers-Configure-LDAP-Select-Authentication-Containers-200x150.png 200w" sizes="(max-width: 1024px) 100vw, 1024px" /></a><br />
Remove the tick from <strong>Use anonymous binds to resolve distinguished names</strong>, and enter the credentials for your service account. In my case this is the domain\vpnsvc service account.<br />
For initial Template select Microsoft AD</p>
<p><a href="../wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers-Configure-LDAP.png"><img title="pfSense 2.0 System Authentication Servers - Configure LDAP" src="../wp-content/uploads/2011/04/pfSense-2.0-System-Authentication-Servers-Configure-LDAP.png" alt="" width="1024" height="768"></a></p>
<p>Now on the Wizard for creating new OpenVPN Server<br />
As Type of Server select LDAP<a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-OpenVPN-Wizard-Select-Authentication-backedn-Type-LDAP.png"><img class="aligncenter size-full wp-image-534" title="pfSense 2.0 OpenVPN Wizard Select Authentication backedn Type - LDAP" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-OpenVPN-Wizard-Select-Authentication-backedn-Type-LDAP.png" alt="" width="1024" height="435" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-OpenVPN-Wizard-Select-Authentication-backedn-Type-LDAP.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-OpenVPN-Wizard-Select-Authentication-backedn-Type-LDAP-300x127.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>As a LDAP server, select the connection that we have configured just now.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-OpenVPN-Wizard-Select-LDAP-Authentication-Server.png"><img class="aligncenter size-full wp-image-535" title="pfSense 2.0 OpenVPN Wizard Select LDAP Authentication Server" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-OpenVPN-Wizard-Select-LDAP-Authentication-Server.png" alt="" width="1024" height="481" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-OpenVPN-Wizard-Select-LDAP-Authentication-Server.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-OpenVPN-Wizard-Select-LDAP-Authentication-Server-300x140.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Continue with the configuration of the OpenVPN server as usual, for references you can check my previous blog post on the topic <a href="http://stefcho.azurewebsites.net/?p=492" target="_blank">pfSense 2.0 RC1 configuration of OpenVPN Server for Road Warrior with TLS and User Authentication</a><strong> </strong><strong> </strong></p>
<p>Now you can connect to the VPN using domain users account, in my example domain\user2.</p>
<p>I’ve test is and now if you disable some user account in Active Directory, you will not authenticate with the AD, and consequently connect to the OpenVPN.</p>
<p>To extend the configuration you can use multiple backend service to authenticate. Open you OpenVPN server configuration and in the section <strong>Backend for authentication</strong> select also the Local Database, or any other available to you. There is a little flow in this method. If you have a user with the same user name and the same password, the request is send first to the AD and after that the local database is queried for the user. I’ve guessed it after a little network sniffing. However how often would you have duplicate users in both databases at the same time? So this is just for your information.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-OpenVPN-Server-Multiple-Backedn-for-Authentication.png"><img class="aligncenter size-full wp-image-536" title="pfSense 2.0 OpenVPN Server Multiple Backedn for Authentication" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-OpenVPN-Server-Multiple-Backedn-for-Authentication.png" alt="" width="1024" height="539" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-OpenVPN-Server-Multiple-Backedn-for-Authentication.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/pfSense-2.0-OpenVPN-Server-Multiple-Backedn-for-Authentication-300x157.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Thank you for reading, have fun.</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/openvpn-with-ldap-authentication-on-pfsense-2-0-rc1/">OpenVPN with LDAP authentication on pfSense 2.0 RC1</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></content:encoded>
							<wfw:commentRss>https://blog.stefcho.eu/openvpn-with-ldap-authentication-on-pfsense-2-0-rc1/feed/</wfw:commentRss>
		<slash:comments>17</slash:comments>
							</item>
		<item>
		<title>pfSense 2.0 RC1 configuration of OpenVPN Server for Road Warrior with TLS and User Authentication</title>
		<link>https://blog.stefcho.eu/pfsense-2-0-rc1-configuration-of-openvpn-server-for-rad-warrior-with-tls-and-user-authentication/</link>
				<comments>https://blog.stefcho.eu/pfsense-2-0-rc1-configuration-of-openvpn-server-for-rad-warrior-with-tls-and-user-authentication/#comments</comments>
				<pubDate>Sun, 17 Apr 2011 15:06:26 +0000</pubDate>
		<dc:creator><![CDATA[Stefan]]></dc:creator>
				<category><![CDATA[Technical]]></category>
		<category><![CDATA[OpenVPN]]></category>
		<category><![CDATA[pfSense]]></category>

		<guid isPermaLink="false">http://stefcho.azurewebsites.net/?p=492</guid>
				<description><![CDATA[<p>VPN is very important service nowadays. The possibility to connect to remote network is very powerful feature used by single user accessing files at home to thousands of business users working remotely with applications and services available previously only on their desktops in the office.&#160; Because of that there are many alternative on the market [&#8230;]</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/pfsense-2-0-rc1-configuration-of-openvpn-server-for-rad-warrior-with-tls-and-user-authentication/">pfSense 2.0 RC1 configuration of OpenVPN Server for Road Warrior with TLS and User Authentication</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></description>
								<content:encoded><![CDATA[<p>VPN is very important service nowadays. The possibility to connect to remote network is very powerful feature used by single user accessing files at home to thousands of business users working remotely with applications and services available previously only on their desktops in the office.&nbsp; Because of that there are many alternative on the market providing such service. In this post I will focus on the OpenVPN running on the new version of pfSense 2.0 RC1. The goal is to compare the new features with the capabilities of the older 1.2.3 version.</p>
<p>One of the reasons choosing OpenVPN was for the rich feature set, small system requirements the level of control. You can easily setup is up on virtual machine or on SoHo router. The possibility to authenticate users not by insecure usernames and passwords, but by certificates was very compelling.</p>
<p>On 1.2.3 version of pfSense, instead of generating the certificates on the router, I was generating them on a Windows Machine. Following guidance from this sources:</p>
<p><a href="http://www.runpcrun.com/howtoopenvpn" target="_blank">http://www.runpcrun.com/howtoopenvpn</a></p>
<p><a href="http://openvpn.net/index.php/open-source/documentation/howto.html#pki" target="_blank">http://openvpn.net/index.php/open-source/documentation/howto.html#pki</a></p>
<p>After generating all the required certificates, it was just a matter of copy / paste in the configuration.</p>
<p>In the new 2.0 version of pfSense there is a Cert Manager. Using it you  can manage your certificate on the box, not just pasting pre-generated  certificates.</p>
<p>The other new feature that we will use is User Manager. You have three options for central location of your users: local database, LDAP and RADIUS.For this post we will use local database, as it is the easiest way.</p>
<p>&nbsp;</p>
<p>As a first&nbsp; step, let&#8217;s install the “OpenVPN Client Export Utility” package, from System &gt; Packages. We will need it later.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPn-Client-Export-Utility2.png"><img class="aligncenter size-full wp-image-501" title="OpenVPn Client Export Utility" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPn-Client-Export-Utility2.png" alt="" width="1024" height="456" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPn-Client-Export-Utility2.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPn-Client-Export-Utility2-300x133.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Then go to System &gt; Cert Management. On the CA (Certificate Authority) leaf, create new one. Take a note of the <strong>Descriptive </strong>and <strong>Common </strong>names you give it, we will need them later. Enter the rest of the details for the CA.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Create-CA-Cert.png"></a><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Create-CA-Cert1.png"><img class="aligncenter size-full wp-image-502" title="Create CA Cert" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/Create-CA-Cert1.png" alt="" width="1024" height="739" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/Create-CA-Cert1.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Create-CA-Cert1-300x216.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Now under System &gt; User Management, create new user account.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Create-New-User.png"><img class="aligncenter size-full wp-image-503" title="Create New User" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/Create-New-User1.png" alt="" width="1024" height="741" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/Create-New-User1.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Create-New-User1-300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a>Tick in the Certificate section &#8220;Click to create a user certificate.&#8221;, or after the user is created, enter the newly created user account and generate a certificate for the user. As a Method select “Create an Internal Certificate”, enter the Distinguished name details.</p>
<p>Now is time to configure the OpneVPN server. Go under VPN &gt; OpenVPN, select the <strong>Wizard </strong>leaf.</p>
<p>For type of Server, select Local User Access<a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-011.png"><img class="aligncenter size-full wp-image-504" title="OpenVPN Wizz 01" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-011.png" alt="" width="1024" height="438" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-011.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-011-300x128.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>For Certificate Authority Select the name of the one we created earlier, in our case Road Warrior CA<a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-02.png"><img class="aligncenter size-full wp-image-505" title="OpenVPN Wizz 02" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-02.png" alt="" width="1024" height="481" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-02.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-02-300x140.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>For Server Certificate, select Add New Certificate, type in something  memorable for Descriptive name, because we will use it right away.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-03.png"><img class="aligncenter size-full wp-image-506" title="OpenVPN Wizz 03" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-03.png" alt="" width="1024" height="480" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-03.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-03-300x140.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>&nbsp;</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Server-Certificate-Creation.png"><img class="aligncenter size-full wp-image-507" title="OpenVPN Server Certificate Creation" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Server-Certificate-Creation.png" alt="" width="1024" height="740" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Server-Certificate-Creation.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Server-Certificate-Creation-300x216.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Now edit the configuration of the OpenVPN server. On this page you can enable TLS.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-04-Confgiuration.png"><img class="aligncenter size-full wp-image-508" title="OpenVPN Wizz 04- Confgiuration" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-04-Confgiuration.png" alt="" width="1024" height="742" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-04-Confgiuration.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-04-Confgiuration-300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Select the size of DH, Encryption Algorithm.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-05-Configuration-II.png"><img class="aligncenter size-full wp-image-509" title="OpenVPN Wizz 05 - Configuration II" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-05-Configuration-II.png" alt="" width="1024" height="741" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-05-Configuration-II.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-05-Configuration-II-300x217.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a>for Tunnel Network choose a subnet that different from your LAN subnet. In the Local Network enter your LAN subnet. Decide on the number of Concurrent Connections, and if you want to use compression.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-06-Configuration-III.png"><img class="aligncenter size-full wp-image-510" title="OpenVPN Wizz 06 - Configuration III" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-06-Configuration-III.png" alt="" width="1024" height="739" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-06-Configuration-III.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-06-Configuration-III-300x216.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a><a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-07-Configuration-III.png"></a></p>
<p>As this is a very basic configuration, we won&#8217;t enter DNS servers, and Default Domain, but you should consider these options, depending on your environment.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-07-Configuration-III.png"><img class="aligncenter size-full wp-image-511" title="OpenVPN Wizz 07 - Configuration III" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-07-Configuration-III.png" alt="" width="1024" height="740" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-07-Configuration-III.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/OpenVPN-Wizz-07-Configuration-III-300x216.png 300w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>Now go to VPN &gt; OpenVPN, select the <strong>Client Export</strong> leaf. The package that we have installed in the beginning gives us the possibility to automatically export archive with the user configuration files.</p>
<p>Find the user for whom you want to export configuration, and click on the<strong> Configuration archive</strong> link.<a href="https://blog.stefcho.eu/wp-content/uploads/2011/04/Export-User-Configuration.png"><img class="aligncenter size-full wp-image-513" title="Export User Configuration" src="https://blog.stefcho.eu/wp-content/uploads/2011/04/Export-User-Configuration.png" alt="" width="1024" height="768" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/04/Export-User-Configuration.png 1024w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Export-User-Configuration-300x225.png 300w, https://blog.stefcho.eu/wp-content/uploads/2011/04/Export-User-Configuration-200x150.png 200w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>If you haven’t already download the OpenVPN client, download and install OpenVPN Client with GUI from <a href="http://swupdate.openvpn.net/community/releases/openvpn-2.1.4-install.exe" target="_blank">Here</a><a href="http://swupdate.openvpn.net/community/releases/openvpn-2.1.4-install.exe"></a></p>
<p>Now open the Configuration Archive and extract the files in this location on the machine from which you are going to establish the VPN connection.</p>
<blockquote><p>C:\Program Files\OpenVPN\config\</p></blockquote>
<p>&nbsp;</p>
<p>You should be able to successfully connect to your VPN from outside.<br />
The management of users and certificate is much easier in pfSense 2.0. You don’t have to keep a Certificate Authority on separate box, and the discomfort with transferring the CRLs is gone. The utility that generates bundles with the required certificates and configuration for each user automate most of the tedious manual work from the previous version.</p>
<p>As a bonus I have recorded the process of configuration, you can check it out here:</p>
<p>&nbsp;</p>
<p>The post <a rel="nofollow" href="https://blog.stefcho.eu/pfsense-2-0-rc1-configuration-of-openvpn-server-for-rad-warrior-with-tls-and-user-authentication/">pfSense 2.0 RC1 configuration of OpenVPN Server for Road Warrior with TLS and User Authentication</a> appeared first on <a rel="nofollow" href="http://blog.stefcho.eu/">Stefcho&#039;s Tech Blog</a>.</p>
]]></content:encoded>
							<wfw:commentRss>https://blog.stefcho.eu/pfsense-2-0-rc1-configuration-of-openvpn-server-for-rad-warrior-with-tls-and-user-authentication/feed/</wfw:commentRss>
		<slash:comments>28</slash:comments>
							</item>
	</channel>
</rss>
