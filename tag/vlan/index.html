<!DOCTYPE html>
<html lang="en-US" prefix="og: http://ogp.me/ns#"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>VLAN Archives - Stefcho's Tech Blog</title><meta property="og:locale" content="en_US"><meta property="og:type" content="object"><meta property="og:title" content="VLAN Archives - Stefcho's Tech Blog"><meta property="og:url" content="https://blog.stefcho.eu/tag/vlan/"><meta property="og:site_name" content="Stefcho's Tech Blog"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//s.w.org"><script type="text/javascript" data-cfasync="false">
	var mi_version         = '7.4.2';
	var mi_track_user      = true;
	var mi_no_track_reason = '';
	
	var disableStr = 'ga-disable-UA-11255880-2';

	/* Function to detect opted out users */
	function __gaTrackerIsOptedOut() {
		return document.cookie.indexOf(disableStr + '=true') > -1;
	}

	/* Disable tracking if the opt-out cookie exists. */
	if ( __gaTrackerIsOptedOut() ) {
		window[disableStr] = true;
	}

	/* Opt-out function */
	function __gaTrackerOptout() {
	  document.cookie = disableStr + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
	  window[disableStr] = true;
	}
	
	if ( mi_track_user ) {
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

		__gaTracker('create', 'UA-11255880-2', 'auto');
		__gaTracker('set', 'forceSSL', true);
		__gaTracker('require', 'displayfeatures');
		__gaTracker('require', 'linkid', 'linkid.js');
		__gaTracker('send','pageview');
	} else {
		console.log( "" );
		(function() {
			/* https://developers.google.com/analytics/devguides/collection/analyticsjs/ */
			var noopfn = function() {
				return null;
			};
			var noopnullfn = function() {
				return null;
			};
			var Tracker = function() {
				return null;
			};
			var p = Tracker.prototype;
			p.get = noopfn;
			p.set = noopfn;
			p.send = noopfn;
			var __gaTracker = function() {
				var len = arguments.length;
				if ( len === 0 ) {
					return;
				}
				var f = arguments[len-1];
				if ( typeof f !== 'object' || f === null || typeof f.hitCallback !== 'function' ) {
					console.log( 'Not running function __gaTracker(' + arguments[0] + " ....) because you are not being tracked. " + mi_no_track_reason );
					return;
				}
				try {
					f.hitCallback();
				} catch (ex) {

				}
			};
			__gaTracker.create = function() {
				return new Tracker();
			};
			__gaTracker.getByName = noopnullfn;
			__gaTracker.getAll = function() {
				return [];
			};
			__gaTracker.remove = noopfn;
			window['__gaTracker'] = __gaTracker;
					})();
		}
</script><link rel="stylesheet" id="wp-block-library-css" href="https://blog.stefcho.eu/wp-includes/css/dist/block-library/style.min.css" type="text/css" media="all"><link rel="stylesheet" id="micro-style-css" href="https://blog.stefcho.eu/wp-content/themes/micro/assets/css/master.css" type="text/css" media="all"><link rel="stylesheet" id="primary-font-css" href="https://fonts.googleapis.com/css?family=Roboto+Mono%3A400%2C500&subset=latin%2Ccyrillic%2Cgreek%2Cvietnamese&ver=5.1.1" type="text/css" media="all"><link rel="stylesheet" id="wpgdprc.css-css" href="https://blog.stefcho.eu/wp-content/plugins/wp-gdpr-compliance/assets/css/front.css" type="text/css" media="all"><style id="wpgdprc.css-inline-css" type="text/css">

            div.wpgdprc .wpgdprc-switch .wpgdprc-switch-inner:before { content: 'Yes'; }
            div.wpgdprc .wpgdprc-switch .wpgdprc-switch-inner:after { content: 'No'; }
        
</style><script type="text/javascript">
/* <![CDATA[ */
var monsterinsights_frontend = {"js_events_tracking":"true","download_extensions":"doc,exe,js,pdf,ppt,tgz,zip,xls","inbound_paths":"[]","home_url":"https:\/\/PLACEHOLDER.wpsho","hash_tracking":"false"};
/* ]]> */
</script><script type="text/javascript" src="https://blog.stefcho.eu/wp-content/plugins/google-analytics-for-wordpress/assets/js/frontend.min.js"></script><script type="text/javascript" src="https://blog.stefcho.eu/wp-includes/js/jquery/jquery.js"></script><script type="text/javascript" src="https://blog.stefcho.eu/wp-includes/js/jquery/jquery-migrate.min.js"></script><style data-context="foundation-flickity-css">/*! Flickity v2.0.2
http://flickity.metafizzy.co
---------------------------------------------- */.flickity-enabled{position:relative}.flickity-enabled:focus{outline:0}.flickity-viewport{overflow:hidden;position:relative;height:100%}.flickity-slider{position:absolute;width:100%;height:100%}.flickity-enabled.is-draggable{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.flickity-enabled.is-draggable .flickity-viewport{cursor:move;cursor:-webkit-grab;cursor:grab}.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down{cursor:-webkit-grabbing;cursor:grabbing}.flickity-prev-next-button{position:absolute;top:50%;width:44px;height:44px;border:none;border-radius:50%;background:#fff;background:hsla(0,0%,100%,.75);cursor:pointer;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.flickity-prev-next-button:hover{background:#fff}.flickity-prev-next-button:focus{outline:0;box-shadow:0 0 0 5px #09f}.flickity-prev-next-button:active{opacity:.6}.flickity-prev-next-button.previous{left:10px}.flickity-prev-next-button.next{right:10px}.flickity-rtl .flickity-prev-next-button.previous{left:auto;right:10px}.flickity-rtl .flickity-prev-next-button.next{right:auto;left:10px}.flickity-prev-next-button:disabled{opacity:.3;cursor:auto}.flickity-prev-next-button svg{position:absolute;left:20%;top:20%;width:60%;height:60%}.flickity-prev-next-button .arrow{fill:#333}.flickity-page-dots{position:absolute;width:100%;bottom:-25px;padding:0;margin:0;list-style:none;text-align:center;line-height:1}.flickity-rtl .flickity-page-dots{direction:rtl}.flickity-page-dots .dot{display:inline-block;width:10px;height:10px;margin:0 8px;background:#333;border-radius:50%;opacity:.25;cursor:pointer}.flickity-page-dots .dot.is-selected{opacity:1}</style><style data-context="foundation-slideout-css">.slideout-menu{position:fixed;left:0;top:0;bottom:0;right:auto;z-index:0;width:256px;overflow-y:auto;-webkit-overflow-scrolling:touch;display:none}.slideout-menu.pushit-right{left:auto;right:0}.slideout-panel{position:relative;z-index:1;will-change:transform}.slideout-open,.slideout-open .slideout-panel,.slideout-open body{overflow:hidden}.slideout-open .slideout-menu{display:block}.pushit{display:none}</style><style type="text/css">
		/* Normal background color and text */
		body, code, kbd, tt, var, pre, input, textarea, select {
			color:#00aa13;
			background-color:#060c08;
		}

		/* Inverted background color and text */
		a:hover,
		.entry .entry-title,
		.comment-form-comment label,
		.form-submit input[type="submit"],
		.widget_calendar caption,
		.comments-area .comments-title,
		.main-navigation.is-extended .sub-menu a:hover,
		.menu-toggle {
			color:#060c08;
			background-color:#00aa13;
		}

		/* Overwrite for links */
		a,
		.main-navigation .menu-item a,
		.main-navigation .sub-menu a:hover,
		button, input  {
			color:#00aa13;
		}

		/* Borders */
		input, button, textarea, select
		.site-footer,
		.homepage-welcome {
			border-color:#00aa13;
		}

		.entry .entry-title a,
		.entry .entry-title a:hover {
			color: #060c08;
		}
	</style><link rel="icon" href="https://blog.stefcho.eu/wp-content/uploads/2018/10/cropped-0-32x32.jpg" sizes="32x32"><link rel="icon" href="https://blog.stefcho.eu/wp-content/uploads/2018/10/cropped-0-192x192.jpg" sizes="192x192"><link rel="apple-touch-icon-precomposed" href="https://blog.stefcho.eu/wp-content/uploads/2018/10/cropped-0-180x180.jpg"><meta name="msapplication-TileImage" content="https://blog.stefcho.eu/wp-content/uploads/2018/10/cropped-0-270x270.jpg"><style>.ios7.web-app-mode.has-fixed header{ background-color: rgba(3,122,221,.88);}</style><style type="text/css" id="wp-custom-css">
			  .entry .entry-content {
    margin: 50px 0; }		</style></head><body class="archive tag tag-vlan tag-78 hfeed">
<div id="page" class="site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	<header id="masthead" class="site-header"><div class="header-image">
			<a href="https://blog.stefcho.eu/" rel="home">
				<img src="/wp-content/uploads/2018/10/0.jpg" height="350" width="1400" alt=""></a>
		</div>
		
		<div class="row">
			<div class="columns small-12">
				<div class="site-branding">
											<p class="site-title"><a href="https://blog.stefcho.eu/" rel="home">Stefcho's Tech Blog</a></p>
											<p class="site-description">Software Development, Cloud, DevOps and PfSense</p>
									</div>

				<nav id="site-navigation" class="main-navigation"><button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
						<span class="screen-reader-text">Menu</span>
					</button>
					<div class="menu-primary-container">
						<div id="primary-menu" class="menu"></div>
					</div>
				</nav></div>
		</div>
	</header><div id="content" class="site-content">

	<section class="section-fullwidth section-main"><div class="row">
			<div class="columns small-12 medium-8">
				<div id="primary" class="content-area">
					<main id="main" class="site-main"><header class="page-header"><h1 class="page-title">Tag: VLAN</h1>						</header><article id="post-695" class="entry post-695 post type-post status-publish format-standard hentry category-technical tag-mikrotik-routerboard-rb250g tag-network tag-pfsense tag-vlan"><header class="entry-header"><h2 class="entry-title"><a href="https://blog.stefcho.eu/pfsense-on-a-stick-802-1q-trunking-with-pfsense-2-0-rc1-and-mikrotik-routerboard-rb250g-smart-gigabit-switch-with-five-ports-and-swos-v1-5/" rel="bookmark">pfSense-On-A-Stick – 802.1Q Trunking With pfSense 2.0 RC1 and Mikrotik RouterBoard RB250G Smart Gigabit Switch with five ports and SwOS v1.5</a></h2>		<div class="entry-meta">
			<span class="posted-on">Posted on <time class="entry-date published" datetime="2011-05-25T21:28:03+02:00">25/05/2011</time> - <time class="updated" datetime="2019-02-18T14:50:02+02:00">18/02/2019</time></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="https://blog.stefcho.eu/author/darko/">Stefan</a></span></span>		</div>
			</header><div class="entry-content">
		<p> </p>
<p>I’ve just got a Mikrotik RouterBoard RB250G. While searching for useful information about its capabilities found very interesting article in the MikroTik Wiki: <a href="http://wiki.mikrotik.com/wiki/SwOS/Router-On-A-Stick" target="_blank">SwOS/Router-On-A-Stick</a> <a href="http://wiki.mikrotik.com/wiki/SwOS/Router-On-A-Stick"></a></p>
<p>This article gave me the idea to use pfSense as a router and trunk a few VLANs.</p>
<p><strong>Scenario</strong></p>
<p>My aim is to reproduce the configuration from the above mentioned post with three VLANs, trunked on a single LAN interface (aka Parent interface) to the pfSense. To make it more usable, every VLAN will be on separate port on the switch (aka Access Port) and have its own instance of DHCP running on the pfSense. In this way, when a client connect to some of the ports he/she will automatically receive configuration contextual to VLAN on this port.</p>
<p>For the installation and basic configuration of pfSense on VMware take a look my previous post<a title="Permanent Link to Install pfSense 2.0 RC1 on VMWare Workstation 7" rel="bookmark permalink" href="http://stefcho.azurewebsites.net/?p=431" target="_blank"> Install pfSense 2.0 RC1 on VMWare Workstation 7</a></p>
<p>The difference here is that the LAN virtual NIC is bridged to the second physical NIC of my workstation and from there directly connected to the RB250G switch.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Network-Diagram.png"><img class="aligncenter size-full wp-image-730" title="Network Diagram" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Network-Diagram.png" alt="" width="492" height="541" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Network-Diagram.png 492w,https://blog.stefcho.eu/wp-content/uploads/2011/05/Network-Diagram-272x300.png 272w" sizes="(max-width: 492px) 100vw, 492px"></a></p>
<p>We start with installed pfSense 2.0 RC1, configure WAN port bridged to my first physical NIC, and LAN port connected to my second physical NIC. For the sake of convenience and because of the problems that I faced initially with the communication on my second NIC, I decide to manage the router through the WAN interface, because its configuration will not change during testing. More on the topic VMware Workstation Virtual Machine and VLANs support, you can find at the bottom of this post.</p>
<p>There are two ways to configure VLANs in pfSense as long as I’m aware. One is through the console and the other is using the Web GUI. Here I will use the latter.</p>
<p><strong>WAN Rules</strong></p>
<p>First let’s configure Rules on the WAN port to allow access to the Web GUI.</p>
<p>Got to Firewall > Rules, on the WAN leaf, add new rule.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfSense-WAN-Rules-01.png"><img class="aligncenter size-full wp-image-696" title="pfSense-WAN-Rules-01" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfSense-WAN-Rules-01.png" alt="" width="919" height="564" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfSense-WAN-Rules-01.png 919w,https://blog.stefcho.eu/wp-content/uploads/2011/05/pfSense-WAN-Rules-01-300x184.png 300w" sizes="(max-width: 919px) 100vw, 919px"></a></p>
<p>The Interface is WAN, Protocol is TCP. Destination port range is HTTPS, enter and description.</p>
<p>This will allow access to the pfSense WebGUI on the WAN IP Address.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfSense-WAN-Rules-02.png"><img class="aligncenter size-full wp-image-697" title="pfSense-WAN-Rules-02" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfSense-WAN-Rules-02.png" alt="" width="913" height="884" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/pfSense-WAN-Rules-02.png 913w,https://blog.stefcho.eu/wp-content/uploads/2011/05/pfSense-WAN-Rules-02-300x290.png 300w" sizes="(max-width: 913px) 100vw, 913px"></a></p>
<p><strong>Creation of VLANs and Interfaces</strong></p>
<p>Go to Interfaces> (assign).</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-01.png"><img class="aligncenter size-full wp-image-705" title="Craetion-of-VLANs-01" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-01.png" alt="" width="359" height="135" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-01.png 359w,https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-01-300x112.png 300w" sizes="(max-width: 359px) 100vw, 359px"></a></p>
<p>Make sure that you second Network port is not assigned to any Interface, if it is removed it. In my case this is em1. This machine has two interface em0 for the WAN, and em1 for the LAN.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-02.png"><img class="aligncenter size-full wp-image-706" title="Craetion-of-VLANs-02" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-02.png" alt="" width="920" height="365" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-02.png 920w,https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-02-300x119.png 300w" sizes="(max-width: 920px) 100vw, 920px"></a></p>
<p>Go to the VLANs leaf, click on the add button.</p>
<p>On the new page make sure that Parent interface is em1. Enter VLAN tag number different from 1.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-04.png"><img class="aligncenter size-full wp-image-708" title="Craetion-of-VLANs-04" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-04.png" alt="" width="915" height="310" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-04.png 915w,https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-04-300x101.png 300w" sizes="(max-width: 915px) 100vw, 915px"></a></p>
<p>I’ve made three VLANs – 100, 200, 300.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-03.png"><img class="aligncenter size-full wp-image-707" title="Craetion-of-VLANs-03" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-03.png" alt="" width="912" height="357" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-03.png 912w,https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-03-300x117.png 300w" sizes="(max-width: 912px) 100vw, 912px"></a></p>
<p>Now we need to assign these as Interfaces, go to Interface assignments and then add them one by one, select the proper Network port which are the VLANs that we have just created, and do not assign em1 to any Interface directly.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-02.png"><img class="aligncenter size-full wp-image-706" title="Craetion-of-VLANs-02" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-02.png" alt="" width="920" height="365" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-02.png 920w,https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-02-300x119.png 300w" sizes="(max-width: 920px) 100vw, 920px"></a></p>
<p>Now select LAN interface from the drop down menu under Interfaces. Tick Enable Interface, as type select Static. Under Static IP configuration, enter IP address and subnet mask.</p>
<p>In my case it is 10.10.10.1/24.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-05-Interfaces-Config.png"><img class="aligncenter size-full wp-image-709" title="Craetion-of-VLANs-05-Interfaces-Config" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-05-Interfaces-Config.png" alt="" width="917" height="843" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-05-Interfaces-Config.png 917w,https://blog.stefcho.eu/wp-content/uploads/2011/05/Craetion-of-VLANs-05-Interfaces-Config-300x275.png 300w" sizes="(max-width: 917px) 100vw, 917px"></a></p>
<p> </p>
<p>Repeat this procedure for all the VLAN interfaces. For reference these are the IP addresses that I have used:</p>
<p>LAN – 10.10.10.1/24</p>
<p>OPT1 – 10.10.9.1/24</p>
<p>OPT2 – 10.10.8.1/24</p>
<p> </p>
<p><strong>Interfaces Rules </strong></p>
<p>For the sake of simplicity every interface will be allowed communication to everywhere.</p>
<p>Go to Firewall > Rules, on the LAN leaf.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/VLANS-Allow-All-Rule-01.png"><img class="aligncenter size-full wp-image-711" title="VLANS-Allow-All-Rule-01" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/VLANS-Allow-All-Rule-01.png" alt="" width="928" height="628" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/VLANS-Allow-All-Rule-01.png 928w,https://blog.stefcho.eu/wp-content/uploads/2011/05/VLANS-Allow-All-Rule-01-300x203.png 300w" sizes="(max-width: 928px) 100vw, 928px"></a></p>
<p>Add new Rule</p>
<p>Action is Pass, Interface is LAN, Protocol in Any, Source is Any, Destination is Any, enter some Description too.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/VLANS-Allow-All-Rule-02.png"><img class="aligncenter size-full wp-image-712" title="VLANS-Allow-All-Rule-02" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/VLANS-Allow-All-Rule-02.png" alt="" width="925" height="739" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/VLANS-Allow-All-Rule-02.png 925w,https://blog.stefcho.eu/wp-content/uploads/2011/05/VLANS-Allow-All-Rule-02-300x239.png 300w" sizes="(max-width: 925px) 100vw, 925px"></a></p>
<p>Repeat this step on OPT1 and OPT2 leafs too.</p>
<p> </p>
<p><strong>DHCP Server Configuration</strong></p>
<p>Go to Services > DHCP Server page.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/DHCP-Config-01.png"><img class="aligncenter size-full wp-image-713" title="DHCP-Config-01" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/DHCP-Config-01.png" alt="" width="502" height="345" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/DHCP-Config-01.png 502w,https://blog.stefcho.eu/wp-content/uploads/2011/05/DHCP-Config-01-300x206.png 300w" sizes="(max-width: 502px) 100vw, 502px"></a></p>
<p>On the LAN leaf, tick Enable DHCP server on LAN interface.</p>
<p>Enter Range from the subnet of the interface, in my case 10.10.10.10 – 10.10.10.15</p>
<p>Click the Save button.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/DHCP-Config-02.png"><img class="aligncenter size-full wp-image-714" title="DHCP-Config-02" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/DHCP-Config-02.png" alt="" width="917" height="890" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/DHCP-Config-02.png 917w,https://blog.stefcho.eu/wp-content/uploads/2011/05/DHCP-Config-02-300x291.png 300w" sizes="(max-width: 917px) 100vw, 917px"></a></p>
<p>Repeat the procedure for the OPT1 and OPT2 leafs. In my case the ranges were.</p>
<p>LAN – 10.10.10.10 – 10.10.10.15</p>
<p>OPT1 – 10.10.9.10 – 10.10.9.15</p>
<p>OPT2 – 10.10.8.10 – 10.10.8.15</p>
<p> </p>
<p><strong>Mikrotik RouterBoard RB250G Smart Gigabit Switch with five ports and SwOS v1.5</strong></p>
<p>Before configuring VLANs on the switch, make sure that your firmware version is 1.2 or higher, by the time of writing this version 1.5 of the firmware is available. Otherwise you may run into problems that are related to applied functionality of the device.</p>
<p><strong> </strong></p>
<p><strong>Switch VLANs Configuration</strong></p>
<p>On the Switch, go to the VLANs leaf, add the same VLANs from the router. As for ports member always add Port1 and choose one of the other ports. This is the tricky part, my pfSense router is connected to Port1, which makes it Trunk port and must be a member of all VLANs.</p>
<p>In my example</p>
<p>Port 5 is member of VLAN 100</p>
<p>Port 4 is member of VLAN 200</p>
<p>Port 3 is member of VLAN 300</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Switch-VLANs-Config-02.png"><img class="aligncenter size-full wp-image-715" title="Switch-VLANs-Config-02" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Switch-VLANs-Config-02.png" alt="" width="773" height="269" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Switch-VLANs-Config-02.png 773w,https://blog.stefcho.eu/wp-content/uploads/2011/05/Switch-VLANs-Config-02-300x104.png 300w" sizes="(max-width: 773px) 100vw, 773px"></a></p>
<p>On the VLAN leaf.</p>
<p>For Port 1, our Trunk Port – VLAN Mode is Enabled, default VLAN ID is 1 and VLAN Header is Add If Missing.</p>
<p>For the other Access Ports the configuration is as follows: VLAN Mode is Strict, Default VLAN ID is configured by your design, from the VLANs configured on the router. You can leave Force VLAN ID unpicked, VLAN Header is Always Strip.</p>
<p><strong> </strong></p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/Switch-VLANs-Config-01.png"><img class="aligncenter size-full wp-image-716" title="Switch-VLANs-Config-01" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/Switch-VLANs-Config-01.png" alt="" width="778" height="361" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/Switch-VLANs-Config-01.png 778w,https://blog.stefcho.eu/wp-content/uploads/2011/05/Switch-VLANs-Config-01-300x139.png 300w" sizes="(max-width: 778px) 100vw, 778px"></a></p>
<p><strong>Testing</strong></p>
<p>Now if you plug the test laptop to one of the Ports 3,4,5. And the NIC is configured to receive configuration from a DHCP server, you will get IP address from the subnet of the configured VLAN range. Because of the Allow All traffic rule you will have Internet, and access to host on the other VLANs.</p>
<p> </p>
<p><strong>Issues</strong></p>
<p>Some issues that I faced along the way.</p>
<p><strong> </strong></p>
<p><strong>VMware Workstation Virtual Machine and VLANs support</strong></p>
<p>My idea was to configure quickly one VM with pfSense, and use the bridged interface for connection to the switch. Everything works fine up until I configured VLANs. Then suddenly the communication between the route and switch stops. After a little network sniffing what surprised me, was that the packets were not tagged with VLANs. After extensive googling on the topic, I did not found definitive reason for this strange behaviour. One part of the information was related to the physical NIC support of VLANs. The other portion of the topics were about the VMware VM and the type of the virtual NIC configured on the virtual machine. Unfortunately my EVGA X58 motherboard is equipped with two on-board Realtek NICS, but fortunately enough they support VLAN and event Priority. When I check the configuration of the bridged NIC <strong>Priority & VLAN </strong>were <strong>Enabled</strong>.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/NIC-02.png"><img class="aligncenter size-full wp-image-718" title="NIC-02" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/NIC-02.png" alt="" width="417" height="466" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/NIC-02.png 417w,https://blog.stefcho.eu/wp-content/uploads/2011/05/NIC-02-268x300.png 268w" sizes="(max-width: 417px) 100vw, 417px"></a></p>
<p>The troubleshooting took me long hours, but finally I’ve got a great idea. What if I turn off the Priority & VLAN support on the physical NIC? And indeed, packets start showing with the 802.1Q Tags. My suspicion is that the physical NIC strips off the VLAN tag, and this is the cause of the disruption in communication between my router and switch.</p>
<p><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/WireShark-Capture.png"></a><a href="https://blog.stefcho.eu/wp-content/uploads/2011/05/WireShark-Capture1.png"><img class="aligncenter size-full wp-image-720" title="WireShark Capture" src="https://blog.stefcho.eu/wp-content/uploads/2011/05/WireShark-Capture1.png" alt="" width="957" height="601" srcset="https://blog.stefcho.eu/wp-content/uploads/2011/05/WireShark-Capture1.png 957w,https://blog.stefcho.eu/wp-content/uploads/2011/05/WireShark-Capture1-300x188.png 300w" sizes="(max-width: 957px) 100vw, 957px"></a></p>
<p><strong>Mikrotik RouterBoard RB250G</strong></p>
<p>If you ping the switch the pings are around 17-9 ms, which is huge taking in to account the device is directly connected.</p>
<p>For more information look here:</p>
<h2><a href="http://forum.mikrotik.com/viewtopic.php?f=17&t=45360&sid=55976ca9471e381ea424613150f9eba8">Pings TO the switch dropped, high ping…</a></h2>
<p> </p>
<p><strong>References:</strong></p>
<ul><li>To get a feeling of the switch Web GUI, take a look here, all interface pages are shown and all options are explained : <a href="http://wiki.mikrotik.com/wiki/SwOS">http://wiki.mikrotik.com/wiki/SwOS</a></li>
<li>This wiki article gave me some ideas for VLANs configuration: <a href="http://wiki.mikrotik.com/wiki/Manual:Interface/VLAN">http://wiki.mikrotik.com/wiki/Manual:Interface/VLAN</a></li>
<li>I like this thread in the forum, probably in future will try to separate Voice and Data in to separate VLANs as discussed: Topic: Setting UP VLAN in pfSense 2.0?  <a href="http://forum.pfsense.org/index.php?topic=34739.0">http://forum.pfsense.org/index.php?topic=34739.0</a></li>
<li>If you are seeking for a Smart Switch take a look at that thread: <a href="http://forum.pfsense.org/index.php/topic,36749.msg189441.html" target="_blank">Smart Switch – Recommendations</a></li>
</ul><p>MikroTik Forum useful links:</p>
<p>The Section about Mikrotik RouterBoard RB250G:</p>
<h2><a href="http://forum.mikrotik.com/viewforum.php?f=17&sid=a56fea589ae8eb3fb1f78b0db629fc72">SwOS</a></h2>
<div id="pageheader">
<p>Some interesting threads:</p>
</div>
<h2><a href="http://forum.mikrotik.com/viewtopic.php?f=17&t=45721">please do not tag default vlan in “add if missing” mode</a></h2>
<h2><a href="http://forum.mikrotik.com/viewtopic.php?f=17&t=51066">VLAN Tagging on SwOS</a></h2>
<h2><a href="http://forum.mikrotik.com/viewtopic.php?f=17&t=46150">VLAN Trunk</a></h2>
<h2><a href="http://forum.mikrotik.com/viewtopic.php?f=17&t=44840">Vlan Trunk / Access port configuration</a></h2>
<h2><a href="http://forum.mikrotik.com/viewtopic.php?f=17&t=44534&sid=faa5992612130e9516b4c4215b06cbf9">QnQ</a></h2>
	</div>

	<footer class="entry-footer"><span class="cat-links">Posted in <a href="https://blog.stefcho.eu/category/technical/" rel="category tag">Technical</a></span><span class="tags-links">Tagged <a href="https://blog.stefcho.eu/tag/mikrotik-routerboard-rb250g/" rel="tag">Mikrotik RouterBoard RB250G</a>, <a href="https://blog.stefcho.eu/tag/network/" rel="tag">Network</a>, <a href="https://blog.stefcho.eu/tag/pfsense/" rel="tag">pfSense</a>, <a href="https://blog.stefcho.eu/tag/vlan/" rel="tag">VLAN</a></span><span class="comments-link"><a href="https://blog.stefcho.eu/pfsense-on-a-stick-802-1q-trunking-with-pfsense-2-0-rc1-and-mikrotik-routerboard-rb250g-smart-gigabit-switch-with-five-ports-and-swos-v1-5/#comments">4 Comments</a></span>	</footer></article></main></div>
			</div>
			<div class="columns small-12 medium-4">
				
<aside id="secondary" class="widget-area" role="complementary"><section id="tag_cloud-3" class="widget widget_tag_cloud"><h2 class="widget-title">Tags</h2><div class="tagcloud"><a href="https://blog.stefcho.eu/tag/adds/" class="tag-cloud-link tag-link-73 tag-link-position-1" style="font-size: 10.082644628099pt;" aria-label="ADDS (2 items)">ADDS</a>
<a href="https://blog.stefcho.eu/tag/aes-ni/" class="tag-cloud-link tag-link-114 tag-link-position-2" style="font-size: 10.082644628099pt;" aria-label="AES-NI (2 items)">AES-NI</a>
<a href="https://blog.stefcho.eu/tag/asterisk/" class="tag-cloud-link tag-link-55 tag-link-position-3" style="font-size: 10.082644628099pt;" aria-label="Asterisk (2 items)">Asterisk</a>
<a href="https://blog.stefcho.eu/tag/asus/" class="tag-cloud-link tag-link-60 tag-link-position-4" style="font-size: 11.471074380165pt;" aria-label="ASUS (3 items)">ASUS</a>
<a href="https://blog.stefcho.eu/tag/azure/" class="tag-cloud-link tag-link-94 tag-link-position-5" style="font-size: 11.471074380165pt;" aria-label="Azure (3 items)">Azure</a>
<a href="https://blog.stefcho.eu/tag/captive-portal/" class="tag-cloud-link tag-link-83 tag-link-position-6" style="font-size: 11.471074380165pt;" aria-label="Captive Portal (3 items)">Captive Portal</a>
<a href="https://blog.stefcho.eu/tag/cell-phone/" class="tag-cloud-link tag-link-64 tag-link-position-7" style="font-size: 8pt;" aria-label="Cell Phone (1 item)">Cell Phone</a>
<a href="https://blog.stefcho.eu/tag/centos/" class="tag-cloud-link tag-link-86 tag-link-position-8" style="font-size: 8pt;" aria-label="CentOS (1 item)">CentOS</a>
<a href="https://blog.stefcho.eu/tag/creative/" class="tag-cloud-link tag-link-66 tag-link-position-9" style="font-size: 10.082644628099pt;" aria-label="Creative (2 items)">Creative</a>
<a href="https://blog.stefcho.eu/tag/dd-wrt/" class="tag-cloud-link tag-link-57 tag-link-position-10" style="font-size: 14.363636363636pt;" aria-label="DD-WRT (6 items)">DD-WRT</a>
<a href="https://blog.stefcho.eu/tag/dns/" class="tag-cloud-link tag-link-92 tag-link-position-11" style="font-size: 8pt;" aria-label="DNS (1 item)">DNS</a>
<a href="https://blog.stefcho.eu/tag/hyper-v/" class="tag-cloud-link tag-link-67 tag-link-position-12" style="font-size: 12.628099173554pt;" aria-label="Hyper-V (4 items)">Hyper-V</a>
<a href="https://blog.stefcho.eu/tag/ldap/" class="tag-cloud-link tag-link-74 tag-link-position-13" style="font-size: 10.082644628099pt;" aria-label="LDAP (2 items)">LDAP</a>
<a href="https://blog.stefcho.eu/tag/learning/" class="tag-cloud-link tag-link-102 tag-link-position-14" style="font-size: 10.082644628099pt;" aria-label="Learning (2 items)">Learning</a>
<a href="https://blog.stefcho.eu/tag/linksys/" class="tag-cloud-link tag-link-56 tag-link-position-15" style="font-size: 8pt;" aria-label="Linksys (1 item)">Linksys</a>
<a href="https://blog.stefcho.eu/tag/microsoft/" class="tag-cloud-link tag-link-63 tag-link-position-16" style="font-size: 11.471074380165pt;" aria-label="Microsoft (3 items)">Microsoft</a>
<a href="https://blog.stefcho.eu/tag/mikrotik-routerboard-rb250g/" class="tag-cloud-link tag-link-79 tag-link-position-17" style="font-size: 8pt;" aria-label="Mikrotik RouterBoard RB250G (1 item)">Mikrotik RouterBoard RB250G</a>
<a href="https://blog.stefcho.eu/tag/network/" class="tag-cloud-link tag-link-65 tag-link-position-18" style="font-size: 19.107438016529pt;" aria-label="Network (17 items)">Network</a>
<a href="https://blog.stefcho.eu/tag/openldap/" class="tag-cloud-link tag-link-87 tag-link-position-19" style="font-size: 8pt;" aria-label="OpenLDAP (1 item)">OpenLDAP</a>
<a href="https://blog.stefcho.eu/tag/openvpn/" class="tag-cloud-link tag-link-72 tag-link-position-20" style="font-size: 16.561983471074pt;" aria-label="OpenVPN (10 items)">OpenVPN</a>
<a href="https://blog.stefcho.eu/tag/openwrt/" class="tag-cloud-link tag-link-71 tag-link-position-21" style="font-size: 8pt;" aria-label="OpenWrt (1 item)">OpenWrt</a>
<a href="https://blog.stefcho.eu/tag/pfcenter/" class="tag-cloud-link tag-link-85 tag-link-position-22" style="font-size: 8pt;" aria-label="pfCenter (1 item)">pfCenter</a>
<a href="https://blog.stefcho.eu/tag/pfsemse/" class="tag-cloud-link tag-link-95 tag-link-position-23" style="font-size: 8pt;" aria-label="pfSemse (1 item)">pfSemse</a>
<a href="https://blog.stefcho.eu/tag/pfsense/" class="tag-cloud-link tag-link-61 tag-link-position-24" style="font-size: 22pt;" aria-label="pfSense (31 items)">pfSense</a>
<a href="https://blog.stefcho.eu/tag/pfsense-2-0-rc1/" class="tag-cloud-link tag-link-81 tag-link-position-25" style="font-size: 13.553719008264pt;" aria-label="pfSense 2.0 RC1 (5 items)">pfSense 2.0 RC1</a>
<a href="https://blog.stefcho.eu/tag/pfsense-2-0-rc3/" class="tag-cloud-link tag-link-84 tag-link-position-26" style="font-size: 14.363636363636pt;" aria-label="pfSense 2.0 RC3 (6 items)">pfSense 2.0 RC3</a>
<a href="https://blog.stefcho.eu/tag/pfsense-2-2/" class="tag-cloud-link tag-link-90 tag-link-position-27" style="font-size: 11.471074380165pt;" aria-label="pfSense 2.2 (3 items)">pfSense 2.2</a>
<a href="https://blog.stefcho.eu/tag/pfsense-2-4-3/" class="tag-cloud-link tag-link-98 tag-link-position-28" style="font-size: 8pt;" aria-label="pfSense 2.4.3 (1 item)">pfSense 2.4.3</a>
<a href="https://blog.stefcho.eu/tag/pki/" class="tag-cloud-link tag-link-77 tag-link-position-29" style="font-size: 10.082644628099pt;" aria-label="PKI (2 items)">PKI</a>
<a href="https://blog.stefcho.eu/tag/radius/" class="tag-cloud-link tag-link-75 tag-link-position-30" style="font-size: 10.082644628099pt;" aria-label="RADIUS (2 items)">RADIUS</a>
<a href="https://blog.stefcho.eu/tag/routing/" class="tag-cloud-link tag-link-80 tag-link-position-31" style="font-size: 8pt;" aria-label="Routing (1 item)">Routing</a>
<a href="https://blog.stefcho.eu/tag/site-to-site/" class="tag-cloud-link tag-link-76 tag-link-position-32" style="font-size: 11.471074380165pt;" aria-label="Site To Site (3 items)">Site To Site</a>
<a href="https://blog.stefcho.eu/tag/technical/" class="tag-cloud-link tag-link-97 tag-link-position-33" style="font-size: 14.942148760331pt;" aria-label="Technical (7 items)">Technical</a>
<a href="https://blog.stefcho.eu/tag/ubuntu/" class="tag-cloud-link tag-link-99 tag-link-position-34" style="font-size: 8pt;" aria-label="Ubuntu (1 item)">Ubuntu</a>
<a href="https://blog.stefcho.eu/tag/uncategorized/" class="tag-cloud-link tag-link-96 tag-link-position-35" style="font-size: 8pt;" aria-label="Uncategorized (1 item)">Uncategorized</a>
<a href="https://blog.stefcho.eu/tag/vlan/" class="tag-cloud-link tag-link-78 tag-link-position-36" style="font-size: 8pt;" aria-label="VLAN (1 item)">VLAN</a>
<a href="https://blog.stefcho.eu/tag/vmware/" class="tag-cloud-link tag-link-62 tag-link-position-37" style="font-size: 14.942148760331pt;" aria-label="VMWare (7 items)">VMWare</a>
<a href="https://blog.stefcho.eu/tag/voip/" class="tag-cloud-link tag-link-59 tag-link-position-38" style="font-size: 10.082644628099pt;" aria-label="VoIP (2 items)">VoIP</a>
<a href="https://blog.stefcho.eu/tag/vyatta/" class="tag-cloud-link tag-link-70 tag-link-position-39" style="font-size: 8pt;" aria-label="Vyatta (1 item)">Vyatta</a>
<a href="https://blog.stefcho.eu/tag/web-sites/" class="tag-cloud-link tag-link-93 tag-link-position-40" style="font-size: 8pt;" aria-label="Web Sites (1 item)">Web Sites</a>
<a href="https://blog.stefcho.eu/tag/windows-server-8/" class="tag-cloud-link tag-link-88 tag-link-position-41" style="font-size: 8pt;" aria-label="Windows Server 8 (1 item)">Windows Server 8</a>
<a href="https://blog.stefcho.eu/tag/windows-server-2008-r2/" class="tag-cloud-link tag-link-68 tag-link-position-42" style="font-size: 12.628099173554pt;" aria-label="Windows Server 2008 R2 (4 items)">Windows Server 2008 R2</a>
<a href="https://blog.stefcho.eu/tag/windows-server-2012-r2/" class="tag-cloud-link tag-link-91 tag-link-position-43" style="font-size: 8pt;" aria-label="Windows Server 2012 R2 (1 item)">Windows Server 2012 R2</a>
<a href="https://blog.stefcho.eu/tag/wireless/" class="tag-cloud-link tag-link-82 tag-link-position-44" style="font-size: 8pt;" aria-label="Wireless (1 item)">Wireless</a>
<a href="https://blog.stefcho.eu/tag/workstation-8/" class="tag-cloud-link tag-link-89 tag-link-position-45" style="font-size: 8pt;" aria-label="Workstation 8 (1 item)">Workstation 8</a></div>
</section><section id="archives-3" class="widget widget_archive"><h2 class="widget-title">Archives</h2>		<ul><li><a href="https://blog.stefcho.eu/2019/03/">March 2019</a></li>
	<li><a href="https://blog.stefcho.eu/2019/02/">February 2019</a></li>
	<li><a href="https://blog.stefcho.eu/2018/10/">October 2018</a></li>
	<li><a href="https://blog.stefcho.eu/2018/08/">August 2018</a></li>
	<li><a href="https://blog.stefcho.eu/2016/03/">March 2016</a></li>
	<li><a href="https://blog.stefcho.eu/2015/04/">April 2015</a></li>
	<li><a href="https://blog.stefcho.eu/2015/03/">March 2015</a></li>
	<li><a href="https://blog.stefcho.eu/2015/01/">January 2015</a></li>
	<li><a href="https://blog.stefcho.eu/2012/02/">February 2012</a></li>
	<li><a href="https://blog.stefcho.eu/2011/10/">October 2011</a></li>
	<li><a href="https://blog.stefcho.eu/2011/09/">September 2011</a></li>
	<li><a href="https://blog.stefcho.eu/2011/08/">August 2011</a></li>
	<li><a href="https://blog.stefcho.eu/2011/07/">July 2011</a></li>
	<li><a href="https://blog.stefcho.eu/2011/06/">June 2011</a></li>
	<li><a href="https://blog.stefcho.eu/2011/05/">May 2011</a></li>
	<li><a href="https://blog.stefcho.eu/2011/04/">April 2011</a></li>
	<li><a href="https://blog.stefcho.eu/2011/03/">March 2011</a></li>
	<li><a href="https://blog.stefcho.eu/2011/02/">February 2011</a></li>
	<li><a href="https://blog.stefcho.eu/2010/07/">July 2010</a></li>
		</ul></section><section id="custom_html-3" class="widget_text widget widget_custom_html"><div class="textwidget custom-html-widget"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:inline-block;width:160px;height:600px" data-ad-client="ca-pub-3838187216577892" data-ad-slot="5149186217"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></section></aside></div>
		</div>
	</section></div>

	<footer id="colophon" class="site-footer section-fullwidth"><div class="row">
			<div class="columns small-12">
				<div class="site-info">
					<a href="https://wordpress.org/">Proudly powered by WordPress</a>
					<span class="sep"> | </span>
					Theme: micro, developed by <a href="http://devrix.com">DevriX</a>.				</div>
			</div>
		</div>
	</footer></div>

<script type="text/javascript" src="https://blog.stefcho.eu/wp-content/themes/micro/assets/scripts/scripts.min.js"></script><script type="text/javascript">
/* <![CDATA[ */
var wpgdprcData = {"ajaxURL":"https:\/\/blog.stefcho.eu\/wp-admin\/admin-ajax.php","ajaxSecurity":"247c927df7","consentVersion":"1","consentStatus":"0","isMultisite":"","path":"\/","blogId":""};
/* ]]> */
</script><script type="text/javascript" src="https://blog.stefcho.eu/wp-content/plugins/wp-gdpr-compliance/assets/js/front.js"></script></body></html>
